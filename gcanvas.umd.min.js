!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).GCanvas={})}(this,(function(t){"use strict";var e,i,s,o,n,a,r,h,l,c,d,u,g,p,f,m,x,M,w,y,b,_,v,k=Object.defineProperty,C=t=>{throw TypeError(t)},T=(t,e,i)=>((t,e,i)=>e in t?k(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i),P=(t,e,i)=>e.has(t)||C("Cannot "+i),I=(t,e,i)=>(P(t,e,"read from private field"),i?i.call(t):e.get(t)),S=(t,e,i)=>e.has(t)?C("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),B=(t,e,i,s)=>(P(t,e,"write to private field"),s?s.call(t,i):e.set(t,i),i),D=(t,e,i)=>(P(t,e,"access private method"),i);class O{constructor(t={}){this.children=[],this.sortByZIndex=t.sortByZIndex||!0,this._zOrderDirty=!1}add(t){return this.children.includes(t)?(console.warn("Object is already in this collection"),t):(this.children.push(t),t.parent=this._owner||this,this.sortByZIndex&&(this._zOrderDirty=!0,t.zIndex=this.children.length-1),t)}remove(t){const e=this.children.indexOf(t);return-1!==e&&(this.children.splice(e,1),t.parent=null,!0)}clear(){this.children.forEach((t=>{t.parent=null})),this.children=[]}bringToFront(t){const e=this.children.indexOf(t);if(-1!==e)if(this.sortByZIndex){let e=!0;for(const i of this.children)if(i!==t&&(i.zIndex||0)>=(t.zIndex||0)){e=!1;break}e||(t.zIndex=Number.MAX_SAFE_INTEGER,this._zOrderDirty=!0,this._normalizeZIndices())}else e!==this.children.length-1&&(this.children.splice(e,1),this.children.push(t));else this.add(t)}sendToBack(t){const e=this.children.indexOf(t);if(-1===e)return this.children.unshift(t),void(t.parent=this._owner||this);if(this.sortByZIndex){let e=!0;for(const i of this.children)if(i!==t&&(i.zIndex||0)<=(t.zIndex||0)){e=!1;break}e||(t.zIndex=Number.MIN_SAFE_INTEGER,this._zOrderDirty=!0,this._normalizeZIndices())}else 0!==e&&(this.children.splice(e,1),this.children.unshift(t))}bringForward(t){const e=this.children.indexOf(t);if(-1!==e&&e!==this.children.length-1)if(this.sortByZIndex){const e=[...this.children].sort(((t,e)=>(t.zIndex||0)-(e.zIndex||0))),i=e.indexOf(t);if(i<e.length-1){const s=e[i+1],o=s.zIndex||0,n=t.zIndex||0;o-n>1?t.zIndex=n+Math.floor((o-n)/2):(t.zIndex=o,s.zIndex=n),this._zOrderDirty=!0,this._normalizeZIndices()}}else{const i=this.children[e+1];this.children[e+1]=t,this.children[e]=i}}sendBackward(t){const e=this.children.indexOf(t);if(!(e<=0))if(this.sortByZIndex){const e=[...this.children].sort(((t,e)=>(t.zIndex||0)-(e.zIndex||0))),i=e.indexOf(t);if(i>0){const s=e[i-1],o=s.zIndex||0,n=t.zIndex||0;n-o>1?t.zIndex=o+Math.floor((n-o)/2):(t.zIndex=o,s.zIndex=n),this._zOrderDirty=!0,this._normalizeZIndices()}}else{const i=this.children[e-1];this.children[e-1]=t,this.children[e]=i}}_normalizeZIndices(){this.children.length<=1||this.children.some((t=>(t.zIndex||0)>1e3||(t.zIndex||0)<-1e3))&&([...this.children].sort(((t,e)=>(t.zIndex||0)-(e.zIndex||0))).forEach(((t,e)=>{t.zIndex=10*e})),this._zOrderDirty=!0)}getSortedChildren(){return this.sortByZIndex&&this._zOrderDirty&&(this.children.sort(((t,e)=>(t.zIndex||0)-(e.zIndex||0))),this._zOrderDirty=!1),this.children}}const E=class t{static calculate(e,i,s,o=10,n=0,a=0){const r=i.width||0,h=i.height||0,l=s.width||0,c=s.height||0,d=s.x||0,u=s.y||0;let g,p,f,m;switch(e){case t.TOP_LEFT:g=d-l/2+o+r/2,p=u-c/2+o+h/2,f="left",m="top";break;case t.TOP_CENTER:g=d,p=u-c/2+o+h/2,f="center",m="top";break;case t.TOP_RIGHT:g=d+l/2-o-r/2,p=u-c/2+o+h/2,f="right",m="top";break;case t.CENTER_LEFT:g=d-l/2+o+r/2,p=u,f="left",m="middle";break;case t.CENTER:g=d,p=u,f="center",m="middle";break;case t.CENTER_RIGHT:g=d+l/2-o-r/2,p=u,f="right",m="middle";break;case t.BOTTOM_LEFT:g=d-l/2+o+r/2,p=u+c/2-o-h/2,f="left",m="bottom";break;case t.BOTTOM_CENTER:g=d,p=u+c/2-o-h/2,f="center",m="bottom";break;case t.BOTTOM_RIGHT:g=d+l/2-o-r/2,p=u+c/2-o-h/2,f="right",m="bottom";break;default:g=d-l/2+o+r/2,p=u-c/2+o+h/2,f="left",m="top"}return g+=n,p+=a,{x:g,y:p,align:f,baseline:m}}static calculateAbsolute(e,i,s,o=10,n=0,a=0){const r={width:s.width,height:s.height,x:s.width/2,y:s.height/2};return t.calculate(e,i,r,o,n,a)}};T(E,"TOP_LEFT","top-left"),T(E,"TOP_CENTER","top-center"),T(E,"TOP_RIGHT","top-right"),T(E,"CENTER_LEFT","center-left"),T(E,"CENTER","center"),T(E,"CENTER_RIGHT","center-right"),T(E,"BOTTOM_LEFT","bottom-left"),T(E,"BOTTOM_CENTER","bottom-center"),T(E,"BOTTOM_RIGHT","bottom-right");let A=E;function W(t,e,i={}){const s=i.offsetX??0,o=i.offsetY??0,n=i.transform;return t.forEach(((t,i)=>{if(i<e.length){const a=e[i];if(n){const e=n(a);t.x=e.x+s,t.y=e.y+o}else t.x=a.x+s,t.y=a.y+o}})),t}function R(t,e={}){const i=e.spacing??10,s=e.padding??0,o=e.align??"start",n=e.centerItems??!0;let a=s,r=0;const h=[];for(const e of t)r=Math.max(r,e.height??0);for(let e=0;e<t.length;e++){const s=t[e],l=s.width??0,c=s.height??0,d=n?a+l/2:a;let u;switch(o){case"center":u=(r-c)/2;break;case"end":u=r-c;break;default:u=0}h.push({x:d,y:u}),a+=l,e<t.length-1&&(a+=i)}return{positions:h,width:a+s,height:r+2*s}}function z(t,e={}){const i=e.spacing??10,s=e.padding??0,o=e.align??"start",n=e.centerItems??!0;let a=s,r=0;const h=[];for(const e of t)r=Math.max(r,e.width??0);for(let e=0;e<t.length;e++){const s=t[e],l=s.width??0,c=s.height??0,d=n?a+c/2:a;let u;switch(o){case"center":u=(r-l)/2;break;case"end":u=r-l;break;default:u=0}h.push({x:u,y:d}),a+=c,e<t.length-1&&(a+=i)}return{positions:h,width:r+2*s,height:a+s}}function L(t,e={}){if(0===t.length)return{positions:[],width:0,height:0};const i=e.columns??4,s=e.spacing??10,o=e.padding??0,n=e.centerItems??!0,a=t[0].width??0,r=t[0].height??0,h=Math.ceil(t.length/i),l=[],c=i*a+(i-1)*s+2*o,d=h*r+(h-1)*s+2*o;let u=o,g=o,p=0;for(let e=0;e<t.length;e++){const t=n?u+a/2:u,e=n?g+r/2:g;l.push({x:t,y:e}),p++,p<i?u+=a+s:(p=0,u=o,g+=r+s)}return{positions:l,width:c,height:d}}function Y(t,e={}){if(0===t.length)return{positions:[],width:0,height:0};const i=e.columns??4,s=e.spacing??10,o=e.padding??0,n=e.centerItems??!0,a=new Array(i).fill(0),r=[];t.forEach(((t,e)=>{const s=e%i,o=Math.floor(e/i),n=t.width??0,h=t.height??0;a[s]=Math.max(a[s],n),void 0===r[o]?r[o]=h:r[o]=Math.max(r[o],h)}));const h=[];let l=o,c=o,d=0;for(let e=0;e<t.length;e++){const u=t[e],g=u.width??0,p=u.height??0,f=r[Math.floor(e/i)],m=n?l+g/2:l,x=n?c+p/2:c;h.push({x:m,y:x}),d++,d<i?l+=a[d-1]+s:(d=0,l=o,c+=f+s)}return{positions:h,width:2*o+a.reduce(((t,e)=>t+e),0)+s*(i-1),height:2*o+r.reduce(((t,e)=>t+e),0)+s*(r.length-1),cols:i,rows:r.length}}class F{static symmetric(t,e,i,s,o=1,n="topleft"){const a="centered"===n?e:e+s/2;return{x:("centered"===n?t:t+i/2)+(Math.random()-.5)*i*o,y:a+(Math.random()-.5)*s*o}}static pointInBox(t,e,i,s,o="topleft"){return"centered"===o?{x:t+(Math.random()-.5)*i,y:e+(Math.random()-.5)*s}:{x:t+Math.random()*i,y:e+Math.random()*s}}static centered(t,e,i,s,o=50,n="topleft"){const a="centered"===n?e:e+s/2;return{x:("centered"===n?t:t+i/2)+2*(Math.random()-.5)*o,y:a+2*(Math.random()-.5)*o}}static gaussian(t,e,i,s,o=40,n="topleft"){const a="centered"===n?e:e+s/2;return{x:("centered"===n?t:t+i/2)+F._gaussian(0,o),y:a+F._gaussian(0,o)}}static radial(t,e,i,s,o=100,n="topleft"){const a="centered"===n?t:t+i/2,r="centered"===n?e:e+s/2,h=Math.random()*Math.PI*2,l=Math.random()*o;return{x:a+Math.cos(h)*l,y:r+Math.sin(h)*l}}static pick(t){return t[Math.floor(Math.random()*t.length)]}static pickOther(t,e){const i=t.filter((t=>t!==e));if(0!==i.length)return F.pick(i)}static float(t,e){return t+Math.random()*(e-t)}static int(t,e){return Math.floor(F.float(t,e+1))}static chance(t=.5){return Math.random()<t}static coin(){return Math.random()<.5}static _gaussian(t=0,e=1){let i=1-Math.random(),s=1-Math.random();return t+e*Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*s)}}class X{constructor(t,e=0){this.real=t,this.imag=e}static fromPolar(t,e){return new X(t*Math.cos(e),t*Math.sin(e))}add(t){return new X(this.real+t.real,this.imag+t.imag)}subtract(t){return new X(this.real-t.real,this.imag-t.imag)}multiply(t){return new X(this.real*t.real-this.imag*t.imag,this.real*t.imag+this.imag*t.real)}divide(t){return new X(this.real/t,this.imag/t)}scale(t){return new X(this.real*t,this.imag*t)}abs(){return Math.sqrt(this.real*this.real+this.imag*this.imag)}}class H{static applyColorScheme(t,e,i,s,o,n){const a=(null==e?void 0:e.data)||[];for(let e=0;e<t.length;e++){const r=t[e],h=4*e;switch(i){case"futuristic":{const i=t[e]/10,s={r:0,g:5,b:10},o={r:0,g:30,b:20};if(i>.7){const t=3.33*(i-.7);a[h]=Math.floor(s.r*(1-t)+o.r*t),a[h+1]=Math.floor(s.g*(1-t)+o.g*t),a[h+2]=Math.floor(s.b*(1-t)+o.b*t)}else{const t=1.43*i;a[h]=Math.floor(s.r*t),a[h+1]=Math.floor(s.g*t),a[h+2]=Math.floor(s.b*t)}a[h+3]=255}break;case"rainbow":if(0===r)a[h]=0,a[h+1]=0,a[h+2]=0,a[h+3]=255;else{const t=(10*r+o)%360,[e,i,s]=n(t,.8,.5);a[h]=e,a[h+1]=i,a[h+2]=s,a[h+3]=255}break;case"grayscale":{const t=0===r?0:255-255*r/s;a[h]=t,a[h+1]=t,a[h+2]=t,a[h+3]=255}break;case"binary":0!==r?(a[h]=0,a[h+1]=0,a[h+2]=0):(a[h]=255,a[h+1]=255,a[h+2]=255),a[h+3]=255;break;case"fire":if(0==r)a[h]=0,a[h+1]=0,a[h+2]=0;else{const t=r/s;if(t<.3){const e=t/.3;a[h]=Math.floor(255*e),a[h+1]=0,a[h+2]=0}else if(t<.6){const e=(t-.3)/.3;a[h]=255,a[h+1]=Math.floor(165*e),a[h+2]=0}else if(t<.9){const e=(t-.6)/.3;a[h]=255,a[h+1]=165+Math.floor(90*e),a[h+2]=Math.floor(255*e)}else a[h]=255,a[h+1]=255,a[h+2]=255}a[h+3]=255;break;case"ocean":if(0===r)a[h]=0,a[h+1]=20,a[h+2]=50;else{const t=r/s;a[h]=Math.floor(10+50*t),a[h+1]=Math.floor(50+150*t),a[h+2]=Math.floor(100+155*t)}a[h+3]=255;break;case"electric":if(0===r)a[h]=0,a[h+1]=0,a[h+2]=0;else{const t=(r+o)%3,e=r%20/20;0===t?(a[h]=Math.floor(255*(.5+.5*Math.sin(e*Math.PI*2))),a[h+1]=Math.floor(128*e),a[h+2]=Math.floor(255*e)):1===t?(a[h]=Math.floor(255*e),a[h+1]=Math.floor(255*(.5+.5*Math.sin(e*Math.PI*2))),a[h+2]=Math.floor(128*e)):(a[h]=Math.floor(128*e),a[h+1]=Math.floor(255*e),a[h+2]=Math.floor(255*(.5+.5*Math.sin(e*Math.PI*2))))}a[h+3]=255;break;case"topographic":if(0===r)a[h]=5,a[h+1]=15,a[h+2]=30;else{const t=r/s;if(t<.1){const e=t/.1;a[h]=Math.floor(5+20*e),a[h+1]=Math.floor(15+40*e),a[h+2]=Math.floor(30+50*e)}else if(t<.3){const e=(t-.1)/.2;a[h]=Math.floor(210+45*e),a[h+1]=Math.floor(180+40*e),a[h+2]=Math.floor(140+30*e)}else if(t<.7){const e=(t-.3)/.4;a[h]=Math.floor(50*(1-e)),a[h+1]=Math.floor(100+80*e),a[h+2]=Math.floor(50*(1-e))}else{const e=(t-.7)/.3;a[h]=Math.floor(150+105*e),a[h+1]=Math.floor(150+105*e),a[h+2]=Math.floor(150+105*e)}}a[h+3]=255;break;default:if(0===r)a[h]=0,a[h+1]=0,a[h+2]=0;else{const t=(r+o)%64;t<16?(a[h]=16*t,a[h+1]=0,a[h+2]=0):t<32?(a[h]=255,a[h+1]=16*(t-16),a[h+2]=0):t<48?(a[h]=255-16*(t-32),a[h+1]=255,a[h+2]=0):(a[h]=0,a[h+1]=255-16*(t-48),a[h+2]=16*(t-48))}a[h+3]=255}}return null!=e?e:a}static pythagorasTree(t,e,i=10,s=-2,o=2,n=-.5,a=3.5){const r=new Uint8Array(t*e),h=e=>Math.floor((e-s)*t/(o-s)),l=t=>Math.floor((t-n)*e/(a-n)),c=(i,s,o,n)=>{const a=h(i),c=l(s),d=h(o),u=l(n);let g=a,p=c;const f=Math.abs(d-a),m=Math.abs(u-c),x=a<d?1:-1,M=c<u?1:-1;let w=f-m;for(;g>=0&&g<t&&p>=0&&p<e&&(r[p*t+g]=255),g!==d||p!==u;){const t=2*w;t>-m&&(w-=m,g+=x),t<f&&(w+=f,p+=M)}},d=(t,e,i,s,o)=>{if(o<=0)return;const n=i-t,a=s-e,r=i+a,h=s-n,l=t+a,u=e-n;((t,e,i,s,o,n,a,r)=>{c(t,e,i,s),c(i,s,o,n),c(o,n,a,r),c(a,r,t,e)})(t,e,i,s,r,h,l,u);const g=Math.PI/4,p=.7*Math.sqrt(n*n+a*a),f=p*Math.cos(Math.atan2(a,n)-g),m=p*Math.sin(Math.atan2(a,n)-g),x=.7*Math.sqrt(n*n+a*a),M=l,w=u,y=M+x*Math.cos(Math.atan2(a,n)+g),b=w+x*Math.sin(Math.atan2(a,n)+g);d(r,h,r+f,h+m,o-1),d(M,w,y,b,o-1)},u=Math.min(i,12);return d(-.5,0,.5,0,u),r}static mandelbrot(t,e,i=100,s=-2.5,o=1,n=-1.5,a=1.5){const r=new Uint8Array(t*e),h=(o-s)/t,l=(a-n)/e;for(let o=0;o<e;o++){const e=o*t,a=n+o*l;for(let o=0;o<t;o++){const t=s+o*h;let n=0,l=0,c=0,d=0,u=0;do{l=2*n*l+a,n=c-d+t,c=n*n,d=l*l,u++}while(c+d<4&&u<i);r[e+o]=u<i?u%256:0}}return r}static julia(t,e,i=100,s=-.7,o=.27,n=1,a=0,r=0){const h=new Uint8Array(t*e),l=2/n,c=-l+a,d=-l+r,u=(l+a-c)/t,g=(l+r-d)/e;for(let n=0;n<e;n++){const e=n*t,a=d+n*g;for(let n=0;n<t;n++){let t=c+n*u,r=a,l=0,d=0,g=0;do{l=t*t,d=r*r,r=2*t*r+o,t=l-d+s,g++}while(l+d<4&&g<i);h[e+n]=g<i?g%256:0}}return h}static tricorn(t,e,i=100,s=-2.5,o=1.5,n=-1.5,a=1.5){const r=new Uint8Array(t*e),h=(o-s)/t,l=(a-n)/e;for(let o=0;o<e;o++){const e=o*t,a=n+o*l;for(let o=0;o<t;o++){const t=s+o*h;let n=0,l=0,c=0,d=0,u=0;do{l=-2*n*l+a,n=c-d+t,c=n*n,d=l*l,u++}while(c+d<4&&u<i);r[e+o]=u<i?u%256:0}}return r}static phoenix(t,e,i=100,s=.5,o=.5,n=-2,a=2,r=-2,h=2){const l=new Uint8Array(t*e),c=(a-n)/t,d=(h-r)/e;for(let a=0;a<e;a++){const e=a*t,h=r+a*d;for(let a=0;a<t;a++){const t=n+a*c;let r=0,d=0,u=0,g=0,p=0,f=0,m=0;do{const e=p-f+t+s*u+o,i=2*r*d+h+s*g;u=r,g=d,r=e,d=i,p=r*r,f=d*d,m++}while(p+f<4&&m<i);l[e+a]=m<i?m%256:0}}return l}static newton(t,e,i=100,s=1e-6,o=-2,n=2,a=-2,r=2){const h=new Uint8Array(t*e),l=s*s,c=n-o,d=r-a,u=new Float64Array(3),g=new Float64Array(3);for(let t=0;t<3;t++){const e=2*Math.PI*t/3;u[t]=Math.cos(e),g[t]=Math.sin(e)}const p=c/t,f=d/e;for(let s=0;s<e;s++){const e=s*t,n=a+s*f;for(let s=0;s<t;s++){let t=o+s*p,a=n,r=0,c=-1;for(;r<i&&c<0;){const e=t*t-a*a,i=2*t*a,s=e*t-i*a-1,o=e*a+i*t,n=3*e,h=3*i,d=n*n+h*h;if(d<l)break;const p=1/d,f=t-(s*n+o*h)*p,m=a-(o*n-s*h)*p;for(let t=0;t<3;t++){const e=f-u[t],i=m-g[t];if(e*e+i*i<l){c=t;break}}t=f,a=m,r++}if(c>=0){const t=1-Math.min(r/i,1),o=85*c;h[e+s]=Math.floor(o+85*t)}else h[e+s]=0}}return h}static sierpinski(t,e,i=6,s=0,o=1,n=0,a=1){const r=new Uint8Array(t*e).fill(1),h=Math.sqrt(3)/2,l=o-s,c=(a-n)/l;if(Math.abs(c-h)>1e-9){const t=(n+a)/2,e=l*h;n=t-e/2,a=t+e/2}const d=(1<<Math.min(i,32))-1,u=(o-s)/t,g=(a-n)/e,p=2/Math.sqrt(3);for(let i=0;i<e;++i){const e=n+i*g,o=Math.floor(e*p),a=.5*o;for(let e=0;e<t;++e){const n=s+e*u;Math.floor(n-a)&o&d&&(r[i*t+e]=0)}}return r}static sierpinskiCarpet(t,e,i=5,s=0,o=1,n=0,a=1){const r=new Uint8Array(t*e).fill(1),h=o-s,l=a-n,c=Math.max(h,l),d=(s+o)/2,u=(n+a)/2;s=d-c/2,o=d+c/2,n=u-c/2,a=u+c/2;const g=Math.pow(3,i),p=(t,e)=>{let i=t,s=e;for(;i>0||s>0;){if(i%3==1&&s%3==1)return!0;i=Math.floor(i/3),s=Math.floor(s/3)}return!1};for(let i=0;i<e;++i){const h=(n+i/e*(a-n))*g,l=(Math.floor(h)%g+g)%g;for(let e=0;e<t;++e){const n=(s+e/t*(o-s))*g;p((Math.floor(n)%g+g)%g,l)&&(r[i*t+e]=0)}}return r}static barnsleyFern(t,e,i=1e5){const s=new Uint8Array(t*e).fill(0);let o=0,n=0;const a=Math.min(t,e)/10,r=t/2;for(let h=0;h<i;h++){const i=Math.random();let h,l;i<.01?(h=0,l=.16*n):i<.86?(h=.85*o+.04*n,l=-.04*o+.85*n+1.6):i<.93?(h=.2*o-.26*n,l=.23*o+.22*n+1.6):(h=-.15*o+.28*n,l=.26*o+.24*n+.44),o=h,n=l;const c=Math.floor(o*a+r),d=Math.floor(e-n*a);if(c>=0&&c<t&&d>=0&&d<e){const e=d*t+c;s[e]<255&&s[e]++}}return s}static lyapunov(t,e,i=1e3,s="AB",o=3.4,n=4,a=3.4,r=4){console.time("lyapunov");const h=(s=s.toUpperCase().replace(/[^AB]/g,"")||"AB").length,l=new Float32Array(t*e);let c=1/0,d=-1/0;for(let u=0;u<e;u++){const g=a+(r-a)*u/e;for(let e=0;e<t;e++){const a=o+(n-o)*e/t;let r=.5;for(let t=0;t<100;t++)r=("A"===s[t%h]?a:g)*r*(1-r);let p=0,f=0;for(;f<i;){const t="A"===s[f%h]?a:g;r=t*r*(1-r);const e=Math.abs(t*(1-2*r));if(p+=Math.log(Math.max(e,1e-10)),f++,Math.abs(p/f)>10)break}const m=p/f;l[u*t+e]=m,m>-10&&m<10&&(m<c&&(c=m),m>d&&(d=m))}}c===d&&(c-=1,d+=1);const u=d-c,g=new Uint8Array(t*e);for(let t=0;t<l.length;t++){let e=l[t];e=Math.max(-10,Math.min(10,e));let i=(e-c)/u;g[t]=Math.floor(255*i)}return console.timeEnd("lyapunov"),g}static koch(t,e,i=4,s=-2,o=2,n=-2,a=2){const r=new Uint8Array(t*e),h=e=>Math.floor((e-s)*t/(o-s)),l=t=>Math.floor((t-n)*e/(a-n)),c=(i,s,o,n,a)=>{if(a<=0)return void((i,s,o,n)=>{const a=h(i),c=l(s),d=h(o),u=l(n);let g=a,p=c;const f=Math.abs(d-a),m=Math.abs(u-c),x=a<d?1:-1,M=c<u?1:-1;let w=f-m;for(;g>=0&&g<t&&p>=0&&p<e&&(r[p*t+g]=255),g!==d||p!==u;){const t=2*w;t>-m&&(w-=m,g+=x),t<f&&(w+=f,p+=M)}})(i,s,o,n);const d=(o-i)/3,u=(n-s)/3,g=i+d,p=s+u,f=i+2*d,m=s+2*u,x=Math.PI/3,M=g+d*Math.cos(x)-u*Math.sin(x),w=p+d*Math.sin(x)+u*Math.cos(x);c(i,s,g,p,a-1),c(g,p,M,w,a-1),c(M,w,f,m,a-1),c(f,m,o,n,a-1)},d=Math.min(i,10),u=3*Math.sqrt(3)/2,g=[0,-u/2+.5],p=[-1.5,u/2+.5],f=[1.5,u/2+.5];return c(g[0],g[1],p[0],p[1],d),c(p[0],p[1],f[0],f[1],d),c(f[0],f[1],g[0],g[1],d),r}}T(H,"types",{MANDELBROT:"mandelbrot",TRICORN:"tricorn",PHOENIX:"phoenix",JULIA:"julia",SIERPINSKI:"sierpinski",SCARPET:"sierpinskiCarpet",BARNSEY_FERN:"barnsleyFern",KOCH:"koch",PYTHAGORAS_TREE:"pythagorasTree",NEWTON:"newton",LYAPUNOV:"lyapunov"}),T(H,"colors",{FUTURISTIC:"futuristic",RAINBOW:"rainbow",GRAYSCALE:"grayscale",TOPOGRAPHIC:"topographic",FIRE:"fire",OCEAN:"ocean",ELECTRIC:"electric",BINARY:"binary",HISTORIC:"historic"});const G=class{static seed(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(let e=0;e<256;e++){let a;a=1&e?I(this,s)[e]^255&t:I(this,s)[e]^t>>8&255,I(this,o)[e]=I(this,o)[e+256]=a,I(this,n)[e]=I(this,n)[e+256]=I(this,i)[a%12]}}static simplex2(t,e){let i,s,h;const l=(t+e)*I(this,a),c=Math.floor(t+l),d=Math.floor(e+l),u=(c+d)*I(this,r),g=t-c+u,p=e-d+u;let f,m;g>p?(f=1,m=0):(f=0,m=1);const x=g-f+I(this,r),M=p-m+I(this,r),w=g-1+2*I(this,r),y=p-1+2*I(this,r),b=255&c,_=255&d,v=I(this,n)[b+I(this,o)[_]],k=I(this,n)[b+f+I(this,o)[_+m]],C=I(this,n)[b+1+I(this,o)[_+1]];let T=.5-g*g-p*p;T<0?i=0:(T*=T,i=T*T*v.dot2(g,p));let P=.5-x*x-M*M;P<0?s=0:(P*=P,s=P*P*k.dot2(x,M));let S=.5-w*w-y*y;return S<0?h=0:(S*=S,h=S*S*C.dot2(w,y)),70*(i+s+h)}static simplex3(t,e,i){let s,a,r,c;const d=(t+e+i)*I(this,h),u=Math.floor(t+d),g=Math.floor(e+d),p=Math.floor(i+d),f=(u+g+p)*I(this,l),m=t-u+f,x=e-g+f,M=i-p+f;let w,y,b,_,v,k;m>=x?x>=M?(w=1,y=0,b=0,_=1,v=1,k=0):m>=M?(w=1,y=0,b=0,_=1,v=0,k=1):(w=0,y=0,b=1,_=1,v=0,k=1):x<M?(w=0,y=0,b=1,_=0,v=1,k=1):m<M?(w=0,y=1,b=0,_=0,v=1,k=1):(w=0,y=1,b=0,_=1,v=1,k=0);const C=m-w+I(this,l),T=x-y+I(this,l),P=M-b+I(this,l),S=m-_+2*I(this,l),B=x-v+2*I(this,l),D=M-k+2*I(this,l),O=m-1+3*I(this,l),E=x-1+3*I(this,l),A=M-1+3*I(this,l),W=255&u,R=255&g,z=255&p,L=I(this,n)[W+I(this,o)[R+I(this,o)[z]]],Y=I(this,n)[W+w+I(this,o)[R+y+I(this,o)[z+b]]],F=I(this,n)[W+_+I(this,o)[R+v+I(this,o)[z+k]]],X=I(this,n)[W+1+I(this,o)[R+1+I(this,o)[z+1]]];let H=.6-m*m-x*x-M*M;H<0?s=0:(H*=H,s=H*H*L.dot3(m,x,M));let G=.6-C*C-T*T-P*P;G<0?a=0:(G*=G,a=G*G*Y.dot3(C,T,P));let N=.6-S*S-B*B-D*D;N<0?r=0:(N*=N,r=N*N*F.dot3(S,B,D));let U=.6-O*O-E*E-A*A;return U<0?c=0:(U*=U,c=U*U*X.dot3(O,E,A)),32*(s+a+r+c)}static perlin2(t,e){const i=Math.floor(t),s=Math.floor(e);t-=i,e-=s;const a=255&i,r=255&s,h=I(this,n)[a+I(this,o)[r]].dot2(t,e),l=I(this,n)[a+I(this,o)[r+1]].dot2(t,e-1),g=I(this,n)[a+1+I(this,o)[r]].dot2(t-1,e),p=I(this,n)[a+1+I(this,o)[r+1]].dot2(t-1,e-1),f=D(this,c,d).call(this,t);return D(this,c,u).call(this,D(this,c,u).call(this,h,g,f),D(this,c,u).call(this,l,p,f),D(this,c,d).call(this,e))}static perlin3(t,e,i){const s=Math.floor(t),a=Math.floor(e),r=Math.floor(i);t-=s,e-=a,i-=r;const h=255&s,l=255&a,g=255&r,p=I(this,n)[h+I(this,o)[l+I(this,o)[g]]].dot3(t,e,i),f=I(this,n)[h+I(this,o)[l+I(this,o)[g+1]]].dot3(t,e,i-1),m=I(this,n)[h+I(this,o)[l+1+I(this,o)[g]]].dot3(t,e-1,i),x=I(this,n)[h+I(this,o)[l+1+I(this,o)[g+1]]].dot3(t,e-1,i-1),M=I(this,n)[h+1+I(this,o)[l+I(this,o)[g]]].dot3(t-1,e,i),w=I(this,n)[h+1+I(this,o)[l+I(this,o)[g+1]]].dot3(t-1,e,i-1),y=I(this,n)[h+1+I(this,o)[l+1+I(this,o)[g]]].dot3(t-1,e-1,i),b=I(this,n)[h+1+I(this,o)[l+1+I(this,o)[g+1]]].dot3(t-1,e-1,i-1),_=D(this,c,d).call(this,t),v=D(this,c,d).call(this,e),k=D(this,c,d).call(this,i);return D(this,c,u).call(this,D(this,c,u).call(this,D(this,c,u).call(this,p,M,_),D(this,c,u).call(this,f,w,_),k),D(this,c,u).call(this,D(this,c,u).call(this,m,y,_),D(this,c,u).call(this,x,b,_),k),v)}};e=new WeakMap,i=new WeakMap,s=new WeakMap,o=new WeakMap,n=new WeakMap,a=new WeakMap,r=new WeakMap,h=new WeakMap,l=new WeakMap,c=new WeakSet,d=function(t){return t*t*t*(t*(6*t-15)+10)},u=function(t,e,i){return(1-i)*t+i*e},S(G,c),S(G,e,class{constructor(t,e,i){this.x=t,this.y=e,this.z=i}dot2(t,e){return this.x*t+this.y*e}dot3(t,e,i){return this.x*t+this.y*e+this.z*i}}),S(G,i,[new(I(G,e))(1,1,0),new(I(G,e))(-1,1,0),new(I(G,e))(1,-1,0),new(I(G,e))(-1,-1,0),new(I(G,e))(1,0,1),new(I(G,e))(-1,0,1),new(I(G,e))(1,0,-1),new(I(G,e))(-1,0,-1),new(I(G,e))(0,1,1),new(I(G,e))(0,-1,1),new(I(G,e))(0,1,-1),new(I(G,e))(0,-1,-1)]),S(G,s,[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),S(G,o,new Array(512)),S(G,n,new Array(512)),S(G,a,.5*(Math.sqrt(3)-1)),S(G,r,(3-Math.sqrt(3))/6),S(G,h,1/3),S(G,l,1/6),G.seed(0);let N=G;function U(t,e,i,s,o,n,a){e.y>i.y&&([e,i]=[i,e]),e.y>s.y&&([e,s]=[s,e]),i.y>s.y&&([i,s]=[s,i]);const r=o[0],h=o[1],l=o[2],c=o[3]||255;if(i.y===s.y)Z(t,e,i,s,r,h,l,c,n,a);else if(e.y===i.y)$(t,e,i,s,r,h,l,c,n,a);else{const o={x:Math.floor(e.x+(i.y-e.y)/(s.y-e.y)*(s.x-e.x)),y:i.y};Z(t,e,i,o,r,h,l,c,n,a),$(t,i,o,s,r,h,l,c,n,a)}}function Z(t,e,i,s,o,n,a,r,h,l){const c=(i.x-e.x)/(i.y-e.y||1),d=(s.x-e.x)/(s.y-e.y||1);let u=e.x,g=e.x;for(let s=e.y;s<=i.y;s++){if(s>=0&&s<l){const e=Math.max(0,Math.min(Math.floor(u),h-1)),i=Math.max(0,Math.min(Math.floor(g),h-1));for(let l=Math.min(e,i);l<=Math.max(e,i);l++){const e=4*(s*h+l);e>=0&&e<t.length-3&&(t[e]=o,t[e+1]=n,t[e+2]=a,t[e+3]=r)}}u+=c,g+=d}}function $(t,e,i,s,o,n,a,r,h,l){const c=(s.x-e.x)/(s.y-e.y||1),d=(s.x-i.x)/(s.y-i.y||1);let u=s.x,g=s.x;for(let i=s.y;i>e.y;i--)if(i>=0&&i<l){u-=c,g-=d;const e=Math.max(0,Math.min(Math.floor(u),h-1)),s=Math.max(0,Math.min(Math.floor(g),h-1));for(let l=Math.min(e,s);l<=Math.max(e,s);l++){const e=4*(i*h+l);e>=0&&e<t.length-3&&(t[e]=o,t[e+1]=n,t[e+2]=a,t[e+3]=r)}}}function q(t,e,i,s,o,n){const a=s[0],r=s[1],h=s[2],l=s[3]||255;let c=e.x,d=e.y,u=i.x,g=i.y;const p=Math.abs(u-c),f=Math.abs(g-d),m=c<u?1:-1,x=d<g?1:-1;let M=p-f;for(;;){if(c>=0&&c<o&&d>=0&&d<n){const e=4*(d*o+c);if(e>=0&&e<t.length-3){const i=l/255;t[e]=Math.round(t[e]*(1-i)+a*i),t[e+1]=Math.round(t[e+1]*(1-i)+r*i),t[e+2]=Math.round(t[e+2]*(1-i)+h*i),t[e+3]=255}}if(c===u&&d===g)break;const e=2*M;e>-f&&(M-=f,c+=m),e<p&&(M+=p,d+=x)}}const j=class t{static disableAll(){t.enabledClasses=new Set,t.globalLevel=0}static disable(){t.enabled=!1}static enable(){t.enabled=!0}static setLevel(e){t.globalLevel=e}static enableFor(e){t.enabledClasses.add(e)}static disableFor(e){t.enabledClasses.delete(e)}static setOutput(e){t.output=e}constructor(t){this.className=t}static getLogger(e){return t.loggerz[e]||(t.loggerz[e]=new t(e)),t.loggerz[e]}_log(e,i,...s){t.enabled&&(t.globalLevel>=e||t.enabledClasses.has(this.className))&&t.output[i](`[${this.className}]`,...s)}log(...e){this._log(t.INFO,"log",...e)}warn(...e){this._log(t.WARN,"warn",...e)}error(...e){this._log(t.ERROR,"error",...e)}debug(...e){this._log(t.DEBUG,"log",...e)}table(...e){this._log(t.INFO,"table",...e)}groupCollapsed(e){t.enabled&&t.output.groupCollapsed(`[${this.className}] ${e}`)}groupEnd(){t.enabled&&t.output.groupEnd()}time(e){t.enabled&&t.output.time(`[${this.className}] ${e}`)}timeEnd(e){t.enabled&&t.output.timeEnd(`[${this.className}] ${e}`)}clear(){t.output.clear()}};T(j,"ERROR",1),T(j,"WARN",2),T(j,"INFO",3),T(j,"DEBUG",4),T(j,"globalLevel",j.ERROR),T(j,"enabledClasses",new Set),T(j,"output",console),T(j,"enabled",!0),T(j,"loggerz",[]);let V=j;class J{constructor(t={}){this.name=t.name||this.constructor.name,this._logger=this.getLogger(t)}get logger(){return null==this._logger?this.getLogger():this._logger}trace(t="render"){this.logger.log(null==this.name?this.constructor.name:this.name,t,"x",this.x,"y",this.y,"w",this.width,"h",this.height,"opacity",this._opacity,"visible",this._visible,"active",this._active,"debug",this.debug)}getLogger(t){return V.getLogger(t.name||this.constructor.name)}}const K=class t{static getInstance(){return t.instance||(t.instance=new t),t.instance}constructor(){this.createTab()}createTab(){this.tab=document.createElement("div"),Object.assign(this.tab.style,{position:"fixed",bottom:"0",left:"0",right:"0",height:"30px",backgroundColor:"#333",color:"#fff",padding:"5px",cursor:"pointer",fontFamily:"monospace",zIndex:"10000",display:"flex",justifyContent:"space-between",alignItems:"center"}),this.tab.innerText="Console";const t=document.createElement("div"),e=(t,e)=>{const i=document.createElement("button");return i.innerText=t,Object.assign(i.style,{marginLeft:"5px",padding:"2px 5px",fontFamily:"monospace",cursor:"pointer"}),i.onclick=e,i};this.paused=!1,this.scrollLock=!0,t.appendChild(e("Clear",(()=>this.consoleArea.value=""))),t.appendChild(e("Pause",(()=>this.paused=!this.paused))),t.appendChild(e("Scroll Lock",(()=>this.scrollLock=!this.scrollLock))),this.tab.appendChild(t),document.body.appendChild(this.tab),this.consoleArea=document.createElement("textarea"),Object.assign(this.consoleArea.style,{position:"fixed",bottom:"30px",left:"0",right:"0",height:"200px",display:"none",backgroundColor:"#111",color:"#0f0",fontFamily:"monospace",zIndex:"9999",padding:"10px",resize:"none"}),this.consoleArea.readOnly=!0,document.body.appendChild(this.consoleArea),this.tab.onclick=t=>{t.target===this.tab&&(this.consoleArea.style.display="none"===this.consoleArea.style.display?"block":"none")}}appendMessage(t,e,...i){if(this.paused)return;const s=`[${t.toUpperCase()}] ${e} ${i.join(" ")}\n`;this.consoleArea.value+=s,this.scrollLock&&(this.consoleArea.scrollTop=this.consoleArea.scrollHeight)}log(t,...e){this.appendMessage("log",t,...e)}warn(t,...e){this.appendMessage("warn",t,...e)}error(t,...e){this.appendMessage("error",t,...e)}table(t){const e=JSON.stringify(t,null,2);this.appendMessage("table",e)}groupCollapsed(t){this.appendMessage("group",`Group Start: ${t}`)}groupEnd(){this.appendMessage("group","Group End")}time(t){this[`time_${t}`]=performance.now()}timeEnd(t){const e=(performance.now()-this[`time_${t}`]).toFixed(2);this.appendMessage("time",`${t}: ${e} ms`)}};T(K,"instance");let Q=K;const tt=class t{static dropShadow(t,e,i=0,s=0){ht.ctx.shadowColor=t,ht.ctx.shadowBlur=e,ht.ctx.shadowOffsetX=i,ht.ctx.shadowOffsetY=s}static clearShadow(){ht.ctx.shadowColor="rgba(0, 0, 0, 0)",ht.ctx.shadowBlur=0,ht.ctx.shadowOffsetX=0,ht.ctx.shadowOffsetY=0}static setAlpha(t){ht.ctx.globalAlpha=t}static setBlendMode(t){ht.ctx.globalCompositeOperation=t}static clipRect(t,e,i,s){ht.ctx.beginPath(),ht.ctx.rect(t,e,i,s),ht.ctx.clip()}static clipCircle(t,e,i){ht.ctx.beginPath(),ht.shapes.arc(t,e,i,0,2*Math.PI),ht.ctx.clip()}static blurRegion(t,e,i,s,o){const n=ht.ctx.filter;ht.ctx.filter=`blur(${o}px)`;const a=ht.ctx.getImageData(t,e,i,s);ht.ctx.putImageData(a,t,e),ht.ctx.filter=n}static createGlow(e,i,s={}){const o="glow-"+Math.random().toString(36).substr(2,9),n={id:o,type:"glow",active:!0,time:0,color:e,blur:i,options:{pulseSpeed:0,pulseMin:.5*i,pulseMax:1.5*i,colorShift:0,...s},update(t){return Object.assign(this,t),this},stop(){return this.active=!1,t._activeEffects.delete(this.id),this},apply(){if(!this.active)return;let t=this.blur,e=this.color;if(this.options.pulseSpeed>0){const e=.5*Math.sin(this.time*this.options.pulseSpeed)+.5;t=this.options.pulseMin+e*(this.options.pulseMax-this.options.pulseMin)}return this.options.colorShift>0&&(e=e.replace("hue",this.time*this.options.colorShift%360)),ht.ctx.shadowColor=e,ht.ctx.shadowBlur=t,ht.ctx.shadowOffsetX=0,ht.ctx.shadowOffsetY=0,this.time+=1/60,this}};return t._activeEffects.set(o,n),t._startAnimationLoop(),n}static _startAnimationLoop(){if(null!==t._animationId)return;const e=()=>{if(t._activeEffects.forEach((t=>{t.active&&t.apply()})),0===t._activeEffects.size)return cancelAnimationFrame(t._animationId),void(t._animationId=null);t._animationId=requestAnimationFrame(e)};t._animationId=requestAnimationFrame(e)}static clearAllEffects(){t._activeEffects.forEach((t=>t.stop())),t._activeEffects.clear(),ht.ctx.shadowColor="rgba(0, 0, 0, 0)",ht.ctx.shadowBlur=0,ht.ctx.shadowOffsetX=0,ht.ctx.shadowOffsetY=0,ht.ctx.filter="none",ht.ctx.globalAlpha=1,ht.ctx.globalCompositeOperation="source-over"}};T(tt,"_activeEffects",new Map),T(tt,"_animationId",null);let et=tt;class it{static draw(t,e=0,i=0,{width:s,height:o,crop:n=null,anchor:a="topâ€‘left",rotation:r=0,scaleX:h=1,scaleY:l=1,flipX:c=!1,flipY:d=!1,alpha:u=1,smoothing:g=!0}={}){const p=ht.ctx;if(!p||!t)return;const f=s??(n?n.sw:t.width??t.videoWidth),m=o??(n?n.sh:t.height??t.videoHeight),x=-f*({left:0,center:.5,right:1}[a.split("-").pop()]??0),M=-m*({top:0,center:.5,bottom:1}[a.split("-")[0]]??0);if(p.save(),p.imageSmoothingEnabled=g,p.globalAlpha*=u,p.translate(e,i),r&&p.rotate(r),(c||d)&&p.scale(c?-1:1,d?-1:1),p.scale(h,l),n){const{sx:e,sy:i,sw:s,sh:o}=n;p.drawImage(t,e,i,s,o,x,M,f,m)}else p.drawImage(t,x,M,f,m);p.restore()}static blit(t,e,i,s,o){this.draw(t,e,i,{width:s,height:o})}static createPattern(t,e="repeat"){return ht.ctx.createPattern(t,e)}static fillPattern(t,e,i,s,o){const n=ht.ctx;n.save(),n.fillStyle=t,n.fillRect(e,i,s,o),n.restore()}static createImageData(t,e){return ht.ctx.createImageData(t,e)}static cloneImageData(t){return new ImageData(new Uint8ClampedArray(t.data),t.width,t.height)}static getImageData(t,e,i,s){return ht.ctx.getImageData(t,e,i,s)}static putImageData(t,e,i,s=0,o=0,n=t.width,a=t.height){ht.ctx.putImageData(t,e,i,s,o,n,a)}static mapPixels(t,e){const i=t.data;for(let t=0;t<i.length;t+=4){const s=t>>2,o=e(i[t],i[t+1],i[t+2],i[t+3],s);o&&([i[t],i[t+1],i[t+2],i[t+3]]=o)}return t}static setPixel(t,e,i,s,o,n,a=255){const r=4*(i*t.width+e),h=t.data;h[r]=s,h[r+1]=o,h[r+2]=n,h[r+3]=a}static async toBitmap({type:t="image/png",quality:e=.92}={}){const i=ht.ctx.canvas,s=await i.convertToBlob({type:t,quality:e});return createImageBitmap(s)}static async createBitmap(t){return createImageBitmap(t)}static toImageData(t,e,i){if(t.length!==e*i*4)throw new Error("Invalid RGBA array size for given dimensions");return new ImageData(t,e,i)}static async createImageBitmapFromPixels(t,e,i){const s=this.toImageData(t,e,i);return await createImageBitmap(s)}static createPatternFromImageData(t,e="repeat"){const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const s=i.getContext("2d");return s.putImageData(t,0,0),s.createPattern(i,e)}static createPatternFromPixels(t,e,i,s="repeat"){const o=this.toImageData(t,e,i);return this.createPatternFromImageData(o,s)}}class st{static path(t,e,i,s=1){const o=ht.ctx;o.beginPath();for(const e of t){const[t,...i]=e;"M"===t?o.moveTo(...i):"L"===t?o.lineTo(...i):"C"===t?o.bezierCurveTo(...i):"Q"===t?o.quadraticCurveTo(...i):"Z"===t&&o.closePath()}e&&(o.fillStyle=e,ht.colors.fill(e)),i&&(o.strokeStyle=i,o.lineWidth=s,ht.colors.stroke())}static line(t,e,i,s,o,n){ht.ctx.beginPath(),ht.ctx.moveTo(t,e),ht.ctx.lineTo(i,s),ht.colors.stroke(o,n)}static beginPath(){ht.ctx.beginPath()}static closePath(){ht.ctx.closePath()}static moveTo(t,e){ht.ctx.moveTo(t,e)}static lineTo(t,e){ht.ctx.lineTo(t,e)}static bezierCurveTo(t,e,i,s,o,n){ht.ctx.bezierCurveTo(t,e,i,s,o,n)}static dashedLine(t,e,i,s,o,n,a){ht.ctx.beginPath(),n&&(ht.ctx.strokeStyle=n),void 0!==a&&(ht.ctx.lineWidth=a),ht.ctx.setLineDash(o),ht.ctx.moveTo(t,e),ht.ctx.lineTo(i,s),ht.colors.stroke(),ht.ctx.setLineDash([])}static dottedLine(t,e,i,s,o=2,n=5,a){return ht.lines.dashedLine(t,e,i,s,[o,n],a,o)}static setLineDash(t){ht.ctx.setLineDash(t)}static resetLineDash(){ht.ctx.setLineDash([])}static setLineWidth(t){ht.ctx.lineWidth=t}static quadraticCurve(t,e,i,s,o,n,a,r){ht.ctx.beginPath(),ht.ctx.moveTo(t,e),ht.ctx.quadraticCurveTo(i,s,o,n),a&&(ht.ctx.strokeStyle=a),void 0!==r&&(ht.ctx.lineWidth=r),ht.colors.stroke()}}class ot{static pushOpacity(t){const e=this._opacityStack[this._opacityStack.length-1]*t;this._opacityStack.push(e),ht.logger.log("NEXT OPACITY WILL BE",e),ht.effects.setAlpha(e)}static popOpacity(){if(this._opacityStack.length>1){this._opacityStack.pop();const t=this._opacityStack[this._opacityStack.length-1];ht.logger.log("NEXT OPACITY WILL BE",t),ht.effects.setAlpha(t)}}static _clone(){this._opacityStack=[...this._opacityStack]}static saveOpacityState(){this._opacityStateBackup=[...this._opacityStack]}static restoreOpacityState(){this._opacityStateBackup&&(this._opacityStack=this._opacityStateBackup,delete this._opacityStateBackup)}}T(ot,"_opacityStack",[1]);class nt{static rect(t,e,i,s,o){const n=ht.ctx.fillStyle;ht.colors.fill(o),ht.ctx.fillRect(t,e,i,s),ht.ctx.fillStyle=n}static outlineRect(t,e,i,s,o,n=1){const a=ht.ctx.strokeStyle,r=ht.ctx.lineWidth;ht.ctx.strokeStyle=o,ht.ctx.lineWidth=n,ht.ctx.strokeRect(t,e,i,s),ht.ctx.strokeStyle=a,ht.ctx.lineWidth=r}static roundRect(t,e,i,s,o=0,n,a,r){let h;h="number"==typeof o?[o,o,o,o]:Array.isArray(o)?4===o.length?o:[o[0]||0,o[1]||o[0]||0,o[2]||o[0]||0,o[3]||o[1]||o[0]||0]:[0,0,0,0];const[l,c,d,u]=h,g=t+i,p=e+s;ht.lines.beginPath(),ht.lines.moveTo(t+l,e),ht.lines.lineTo(g-c,e),this.arc(g-c,e+c,c,-Math.PI/2,0),ht.lines.lineTo(g,p-d),this.arc(g-d,p-d,d,0,Math.PI/2),ht.lines.lineTo(t+u,p),this.arc(t+u,p-u,u,Math.PI/2,Math.PI),ht.lines.lineTo(t,e+l),this.arc(t+l,e+l,l,Math.PI,-Math.PI/2),ht.lines.closePath(),n&&(ht.fillStyle=n,ht.colors.fill(n)),a&&ht.colors.stroke(a,r)}static fillRoundRect(t,e,i,s,o=0,n){this.roundRect(t,e,i,s,o,n,null)}static strokeRoundRect(t,e,i,s,o=0,n,a){this.roundRect(t,e,i,s,o,null,n,a)}static fillCircle(t,e,i,s){ht.logger.log("PainterShapes.fillCircle",t,e,i,s),ht.lines.beginPath(),this.arc(t,e,i,0,2*Math.PI),ht.colors.fill(s)}static arc(t,e,i,s,o,n){ht.ctx.arc(t,e,i,s,o,n)}static strokeCircle(t,e,i,s,o){ht.lines.beginPath(),this.arc(t,e,i,0,2*Math.PI),ht.colors.stroke(s,o)}static fillEllipse(t,e,i,s,o=0,n){ht.lines.beginPath(),this.ellipse(t,e,i,s,o,0,2*Math.PI),n&&(ht.fillStyle=n),ht.colors.fill(n)}static strokeEllipse(t,e,i,s,o=0,n,a){ht.lines.beginPath(),this.ellipse(t,e,i,s,o,0,2*Math.PI),n&&(ht.strokeStyle=n),void 0!==a&&(ht.lineWidth=a),ht.colors.stroke(n,a)}static ellipse(t,e,i,s,o,n,a,r){ht.ctx.ellipse(t,e,i,s,o,n,a,r)}static polygon(t,e,i,s){if(!(t.length<2)){ht.lines.beginPath(),ht.lines.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)ht.lines.lineTo(t[e].x,t[e].y);ht.lines.closePath(),e&&ht.colors.fill(e),i&&ht.colors.stroke(i,s)}}}class at{static font(){return ht.ctx.font}static setFont(t){ht.ctx.font=t}static setTextAlign(t){ht.ctx.textAlign=t}static setTextBaseline(t){ht.ctx.textBaseline=t}static fillText(t,e,i,s,o){s&&(ht.ctx.fillStyle=s),o&&(ht.ctx.font=o),ht.ctx.fillText(t,e,i)}static strokeText(t,e,i,s,o,n){s&&(ht.ctx.strokeStyle=s),void 0!==o&&(ht.ctx.lineWidth=o),n&&(ht.ctx.font=n),ht.ctx.strokeText(t,e,i)}static measureTextDimensions(t,e,i="start",s="alphabetic"){e&&(ht.ctx.font=e);const o=ht.ctx.measureText(t);let n=0;return"middle"===s&&(n=-1.5),{width:o.width,height:o.actualBoundingBoxAscent+o.actualBoundingBoxDescent,verticalAdjustment:n}}static measureTextWidth(t,e){return e&&(ht.ctx.font=e),ht.ctx.measureText(t).width}static outlinedText(t,e,i,s,o,n,a){a&&(ht.ctx.font=a),ht.ctx.strokeStyle=o,ht.ctx.lineWidth=n,ht.ctx.strokeText(t,e,i),ht.ctx.fillStyle=s,ht.ctx.fillText(t,e,i)}static wrappedText(t,e,i,s,o,n,a){n&&(ht.ctx.fillStyle=n),a&&(ht.ctx.font=a);const r=t.split(" ");let h="",l="",c=1;for(let t=0;t<r.length;t++)l=h+r[t]+" ",ht.ctx.measureText(l).width>s&&t>0?(ht.ctx.fillText(h,e,i),h=r[t]+" ",i+=o,c++):h=l;return ht.ctx.fillText(h,e,i),c*o}static textOnPath(t,e,i,s,o=!1){if(e.length<2)return;i&&(ht.ctx.fillStyle=i),s&&(ht.ctx.font=s);const n=t.split(""),a=n.map((t=>ht.ctx.measureText(t).width));o&&(n.reverse(),a.reverse(),e.reverse());let r=0;for(let t=1;t<e.length;t++){const i=e[t].x-e[t-1].x,s=e[t].y-e[t-1].y;r+=Math.sqrt(i*i+s*s)}let h=(r-a.reduce(((t,e)=>t+e),0))/2;h<0&&(h=0);let l=h;for(let t=0;t<n.length;t++){const i=a[t],{x:s,y:o,angle:r}=getPositionOnPath(e,l);ht.ctx.save(),ht.ctx.translate(s,o),ht.ctx.rotate(r),ht.ctx.fillText(n[t],0,0),ht.ctx.restore(),l+=i}}static getPositionOnPath(t,e){let i=0;for(let s=1;s<t.length;s++){const o=t[s-1],n=t[s],a=n.x-o.x,r=n.y-o.y,h=Math.sqrt(a*a+r*r);if(i+h>=e){const t=(e-i)/h;return{x:o.x+a*t,y:o.y+r*t,angle:Math.atan2(r,a)}}i+=h}const s=t[t.length-1],o=t[t.length-2],n=Math.atan2(s.y-o.y,s.x-o.x);return{x:s.x,y:s.y,angle:n}}}const rt=class t{static get colors(){return D(this,y,b).call(this,"colors",I(this,g)),I(this,g)}static get effects(){return D(this,y,b).call(this,"effects",I(this,p)),I(this,p)}static get img(){return D(this,y,b).call(this,"img",I(this,f)),I(this,f)}static get lines(){return D(this,y,b).call(this,"lines",I(this,m)),I(this,m)}static get opacity(){return D(this,y,b).call(this,"opacity",I(this,x)),I(this,x)}static get shapes(){return D(this,y,b).call(this,"shapes",I(this,M)),I(this,M)}static get text(){return D(this,y,b).call(this,"text",I(this,w)),I(this,w)}static set ctx(t){this._ctx=t}static get ctx(){if(!this._ctx)throw new Error("Cannot access Painter.ctx before initialization!");return this._ctx}static init(e){this._ctx=e,this.saveStack=[],B(this,g,lt),B(this,p,et),B(this,f,it),B(this,m,st),B(this,x,ot),B(this,M,nt),B(this,w,at),t.logger=V.getLogger("Painter"),t.saveStack=[]}static save(){const e=((new Error).stack.split("\n")[2]||"").match(/at\s+(\w+)\.(\w+)/),i=e?`${e[1]}.${e[2]}`:"unknown";this.saveStack.push(i),this.logger.log(`Painter.save() by: ${i}`),this.ctx.save(),t.opacity.saveOpacityState()}static restore(){if(0===this.saveStack.length)return void console.error("PAINTER ERROR: restore() without matching save()!");const e=this.saveStack.pop();this.logger.log(`Painter.restore() balancing save from: ${e}`),this.ctx.restore(),this.ctx.fillStyle=null,this.ctx.strokeStyle=null,t.opacity.restoreOpacityState()}static translateTo(t,e){(isNaN(t)||void 0===t)&&(t=0),(isNaN(e)||void 0===e)&&(e=0),this.logger.log("moveTo",t,e),this.ctx.translate(t,e)}static resetPosition(){this.logger.log("resetPosition");const t=this.ctx.getTransform();this.ctx.setTransform(t.a,t.b,t.c,t.d,0,0)}static withPosition(t,e,i){this.logger.log("withPosition",t,e),this.save(),this.translateTo(t,e),i(),this.restore()}static clear(e=0,i=0,s=t.ctx.canvas.width,o=t.ctx.canvas.height){t.ctx.clearRect(e,i,s,o)}static translate(e,i){t.ctx.translate(e,i)}static rotate(e){t.logger.log("Painter.rotate",e),t.ctx.rotate(e)}static scale(e,i){t.logger.log("Painter.scale",e,i),t.ctx.scale(e,i)}};g=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,x=new WeakMap,M=new WeakMap,w=new WeakMap,y=new WeakSet,b=function(t,e){if(!e)throw new Error(`Painter.${t} is not initialized. Call Painter.init(ctx) first.`)},S(rt,y),S(rt,g,null),S(rt,p,null),S(rt,f,null),S(rt,m,null),S(rt,x,null),S(rt,M,null),S(rt,w,null),T(rt,"logger");let ht=rt;class lt{static fill(t){ht.logger.log("PainterColors.fill - before:",ht.ctx.fillStyle,"setting to:",t),ht.ctx.fillStyle,ht.ctx.fillStyle=t,ht.ctx.fill(),ht.logger.log("PainterColors.fill - after:",ht.ctx.fillStyle)}static strokeOptions(t){t.color&&(ht.ctx.strokeStyle=t.color),void 0!==t.lineWidth&&(ht.ctx.lineWidth=t.lineWidth),t.lineCap&&(ht.ctx.lineCap=t.lineCap),t.lineJoin&&(ht.ctx.lineJoin=t.lineJoin),t.strokeStyle&&(ht.ctx.strokeStyle=t.strokeStyle)}static stroke(t,e){t&&(ht.ctx.strokeStyle=t),void 0!==e&&(ht.ctx.lineWidth=e),ht.ctx.stroke()}static setFillColor(t){ht.ctx.fillStyle=t}static setStrokeColor(t){ht.ctx.strokeStyle=t}static randomColorRGB(){const t=Math.floor(360*Math.random()),e=70+Math.floor(30*Math.random()),i=50+Math.floor(20*Math.random());return ht.colors.hslToRgb(t,e,i)}static randomColorRGBA(t=255){const[e,i,s]=this.randomColorRGB();return[e,i,s,t]}static randomColorHSL(){return`hsl(${360*Math.random()}, 100%, 50%)`}static randomColorHSL_RGBA(t=255){const e=360*Math.random(),i=60+40*Math.random(),s=40+40*Math.random(),[o,n,a]=ht.colors.hslToRgb(e,i,s);return[o,n,a,t]}static randomColorHEX(){return"#"+(1048575*Math.random()*1e6).toString(16).slice(0,6)}static parseColorString(t){if((t=t.trim().toLowerCase()).startsWith("hsl")){const e=t.replace(/hsla?\(|\)/g,""),[i,s,o]=e.split(",").map((t=>t.trim())),n=parseFloat(i),a=parseFloat(s)/100,r=parseFloat(o)/100;return ht.colors.hslToRgb(n,a,r)}if(t.startsWith("#"))return hexToRgb(t);if(t.startsWith("rgb")){const e=t.replace(/rgba?\(|\)/g,""),[i,s,o]=e.split(",").map((t=>parseInt(t.trim())));return[i,s,o]}return[0,0,0]}static rgbArrayToCSS([t,e,i]){return`rgb(${Math.round(t)}, ${Math.round(e)}, ${Math.round(i)})`}static hslToRgb(t,e,i){i/=100;const s=e=>(e+t/30)%12,o=(e/=100)*Math.min(i,1-i),n=t=>i-o*Math.max(-1,Math.min(s(t)-3,Math.min(9-s(t),1)));return[Math.round(255*n(0)),Math.round(255*n(8)),Math.round(255*n(4))]}static rgbToHsl(t,e,i){t/=255,e/=255,i/=255;const s=Math.max(t,e,i),o=Math.min(t,e,i),n=s-o;let a=0,r=0,h=(s+o)/2;if(0!==n)switch(r=n/(1-Math.abs(2*h-1)),s){case t:a=((e-i)/n+6)%6*60;break;case e:a=60*((i-t)/n+2);break;case i:a=60*((t-e)/n+4)}return[a%360,r,h]}static hexToRgb(t){const e=t.replace("#","");return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}static linearGradient(t,e,i,s,o){const n=ht.ctx.createLinearGradient(t,e,i,s);for(const t of o)n.addColorStop(t.offset,t.color);return n}static radialGradient(t,e,i,s,o,n,a){const r=ht.ctx.createRadialGradient(t,e,i,s,o,n);for(const t of a)r.addColorStop(t.offset,t.color);return r}static verticalGradient(t,e,i,s,o){return ht.colors.linearGradient(t,e,t,e+s,o)}static horizontalGradient(t,e,i,s,o){return ht.colors.linearGradient(t,e,t+i,e,o)}static conicGradient(t,e,i,s){if("function"==typeof ht.ctx.createConicGradient){const o=ht.ctx.createConicGradient(i,t,e);for(const t of s)o.addColorStop(t.offset,t.color);return o}return null}static rgba(t,e,i,s=1){return`rgba(${Math.round(t)}, ${Math.round(e)}, ${Math.round(i)}, ${s})`}static hsl(t,e,i){return`hsl(${t}, ${e}%, ${i}%)`}static hsla(t,e,i,s){return`hsla(${t}, ${e}%, ${i}%, ${s})`}}class ct extends J{constructor(t={}){super(t),this._x="number"==typeof t.x?t.x:0,this._y="number"==typeof t.y?t.y:0,this._width="number"==typeof t.width?t.width:0,this._height="number"==typeof t.height?t.height:0,this.logger.log("Euclidian",this._x,this._y,this._width,this._height)}get x(){return this._x}set x(t){this.validateProp(t,"x"),this._x=t}get y(){return this._y}set y(t){this.validateProp(t,"y"),this._y=t}get width(){return this._width}set width(t){this.validateProp(t,"width"),this._width=Math.max(0,t)}get height(){return this._height}set height(t){this.validateProp(t,"height"),this._height=Math.max(0,t)}get debug(){return this._debug}set debug(t){this.validateProp(t,"debug"),this._debug=Boolean(t)}get debugColor(){return this._debugColor}set debugColor(t){this.validateProp(t,"debugColor"),this._debugColor=t}validateProp(t,e){if(null==t)throw new Error("Invalid property value: "+e+" "+t)}}class dt extends ct{constructor(t={}){super(t),this._minX=t.minX,this._maxX=t.maxX,this._minY=t.minY,this._maxY=t.maxY,this._boundsDirty=!0,this._cachedBounds=null,this.crisp=t.crisp??!0,this.logger.log("Geometry2d",this.x,this.y,this.width,this.height)}update(){this.trace("Geometry2d.update"),this.applyConstraints(),this.getBounds()}get minX(){return this._minX}set minX(t){this._minX=t}get maxX(){return this._maxX}set maxX(t){this._maxX=t}get minY(){return this._minY}set minY(t){this._minY=t}get maxY(){return this._maxY}set maxY(t){this._maxY=t}get boundsDirty(){return this._boundsDirty}applyConstraints(){void 0!==this._minX&&(this.x=Math.max(this.x,this._minX)),void 0!==this._maxX&&(this.x=Math.min(this.x,this._maxX)),void 0!==this._minY&&(this.y=Math.max(this.y,this._minY)),void 0!==this._maxY&&(this.y=Math.min(this.y,this._maxY)),this.crisp&&(this.x=Math.round(this.x),this.y=Math.round(this.y),this.width=Math.round(this.width),this.height=Math.round(this.height))}getBounds(){return!this._boundsDirty&&this._cachedBounds||(this._cachedBounds=this.calculateBounds(),this._boundsDirty=!1),this._cachedBounds}calculateBounds(){return{width:this.width,height:this.height,x:this.x,y:this.y}}getLocalPosition(){let t=0,e=0;return this.parent&&(t=this.parent.x,e=this.parent.y),{x:this.x-t-this.width/2,y:this.y-e-this.height/2}}markBoundsDirty(){this._boundsDirty=!0}validateProp(t,e){super.validateProp(t,e),t!==this[e]&&this.markBoundsDirty()}setTopLeft(t,e){return this.x=t+this.width/2,this.y=e+this.height/2,this}setCenter(t,e){return this.x=t,this.y=e,this}}class ut extends dt{constructor(t={}){super(t),this._debug=Boolean(t.debug),this._debugColor="string"==typeof t.debugColor?t.debugColor:"#0f0",this.logger.log("Traceable",this.x,this.y,this.width,this.height)}async drawDebug(){if(!this._debug)return;const t=this.getDebugBounds();this.logger.log(this.constructor.name,"drawDebug",t.x,t.y,t.width,t.height),ht.save(),ht.scale(this.scaleX,this.scaleY),ht.rotate(this.rotation),ht.shapes.outlineRect(t.x,t.y,t.width,t.height,this._debugColor,2),ht.restore()}getDebugBounds(){return{width:this.width,height:this.height,x:this.x-this.width/2,y:this.y-this.height/2}}trace(t="render"){this.logger.log(null==this.name?this.constructor.name:this.name,t,"x",this.x,"y",this.y,"w",this.width,"h",this.height,"opacity",this._opacity,"visible",this._visible,"active",this._active,"debug",this.debug)}}class gt extends ut{constructor(t={}){super(t),this._visible=!1!==t.visible,this._opacity="number"==typeof t.opacity?t.opacity:1,this._active=!1!==t.active,this.zIndex=t.zIndex??0,this._shadowColor=t.shadowColor??void 0,this._shadowBlur=t.shadowBlur??0,this._shadowOffsetX=t.shadowOffsetX??0,this._shadowOffsetY=t.shadowOffsetY??0,this._tick=0,this.logger.log("Renderable",this.x,this.y,this.width,this.height)}render(){var t;if(!this._visible||this._opacity<=0)return;const e=null!=(null==(t=this._anchor)?void 0:t.position);this._debug&&!e&&this.drawDebug(),ht.save(),ht.effects.setBlendMode(this._blendMode),ht.opacity.pushOpacity(this._opacity),this.crisp?ht.translateTo(Math.round(this.x),Math.round(this.y)):ht.translateTo(this.x,this.y),this.applyShadow(ht.ctx),"Renderable"!==this.constructor.name&&this.draw(),ht.opacity.popOpacity(),ht.restore(),this._debug&&e&&this.drawDebug()}draw(){this.drawDebug()}update(t){this.trace("Renderable.update"),this._tick+=t,super.update(t)}applyShadow(t){this._shadowColor&&(t.shadowColor=this._shadowColor,t.shadowBlur=this._shadowBlur,t.shadowOffsetX=this._shadowOffsetX,t.shadowOffsetY=this._shadowOffsetY)}get visible(){return this._visible}set visible(t){this._visible=Boolean(t)}get active(){return this._active}set active(t){this._active=Boolean(t)}get opacity(){return this._opacity}set opacity(t){this._opacity=Math.min(1,Math.max(0,"number"==typeof t?t:1))}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor=t}get shadowBlur(){return this._shadowBlur}set shadowBlur(t){this._shadowBlur=t}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(t){this._shadowOffsetX=t}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(t){this._shadowOffsetY=t}get tick(){return this._tick}}class pt extends gt{constructor(t={}){super(t),this._rotation=t.rotation*Math.PI/180,this._scaleX=t.scaleX??1,this._scaleY=t.scaleY??1,this.logger.log("Transformable",this.x,this.y,this.width,this.height)}draw(){this.applyTransforms()}applyTransforms(){ht.rotate(this._rotation),ht.scale(this._scaleX,this._scaleY)}get rotation(){return this._rotation}set rotation(t){this._rotation=t*Math.PI/180,this.markBoundsDirty()}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX=t,this.markBoundsDirty()}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY=t,this.markBoundsDirty()}calculateBounds(){const t=this.width/2,e=this.height/2,i=[{x:-t,y:-e},{x:t,y:-e},{x:t,y:e},{x:-t,y:e}],s=Math.cos(this._rotation),o=Math.sin(this._rotation),n=i.map((({x:t,y:e})=>{t*=this._scaleX,e*=this._scaleY;const i=t*o+e*s;return{x:t*s-e*o+this.x,y:i+this.y}})),a=n.map((t=>t.x)),r=n.map((t=>t.y)),h=Math.min(...a),l=Math.max(...a),c=Math.min(...r),d=Math.max(...r);return{x:(h+l)/2,y:(c+d)/2,width:l-h,height:d-c}}}class ft extends pt{constructor(t={}){super(t),this._color=t.color??null,this._stroke=t.stroke??null,this._lineWidth=t.lineWidth??1,this._lineJoin=t.lineJoin??"miter",this._lineCap=t.lineCap??"butt",this._miterLimit=t.miterLimit??10,this.logger.log("Shape",this.x,this.y,this.width,this.height)}get color(){return this._color}set color(t){this._color=t}get stroke(){return this._stroke}set stroke(t){this._stroke=t}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=Math.max(0,t)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin=t}get lineCap(){return this._lineCap}set lineCap(t){this._lineCap=t}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit=t}}class mt extends pt{constructor(t={}){super(t),this._collection=new O({sortByZIndex:t.sortByZIndex||!0}),this._collection._owner=this,this._childrenVersion=0,this._cachedBounds=null,t.width=Math.max(0,t.width||0),t.height=Math.max(0,t.height||0),this.userDefinedWidth=t.width,this.userDefinedHeight=t.height,this.userDefinedDimensions=void 0!==t.width&&void 0!==t.height&&(t.width>0||t.height>0)}add(t){if(null==t||null==t)throw new Error("Object is null or undefined");if(!(t instanceof pt))throw new TypeError("Group can only add Transformable instances");return t.parent=this,this._collection.add(t),this._childrenVersion++,this.markBoundsDirty(),t}remove(t){const e=this._collection.remove(t);return e&&(t.parent=null,this._childrenVersion++,this.markBoundsDirty()),e}clear(){this._collection.clear(),this._childrenVersion++,this.markBoundsDirty()}bringToFront(t){return this._collection.bringToFront(t)}sendToBack(t){return this._collection.sendToBack(t)}bringForward(t){return this._collection.bringForward(t)}sendBackward(t){return this._collection.sendBackward(t)}draw(){super.draw(),this.logger.log("Group.draw chilren:",this.children.length);const t=this._collection.getSortedChildren();for(let e=0;e<t.length;e++){const i=t[e];i.visible&&(ht.save(),i.render(),ht.restore())}}update(t){this.logger.groupCollapsed("Group.update");const e=this._collection.getSortedChildren();for(let i=0;i<e.length;i++){const s=e[i];s.active&&"function"==typeof s.update&&s.update(t)}super.update(t),this.logger.groupEnd()}get children(){var t;return(null==(t=this._collection)?void 0:t.children)||[]}get width(){return this.userDefinedDimensions?this._width:this.getBounds().width}set width(t){const e=Math.max(0,t);this._width=e,this.userDefinedWidth=e,this.userDefinedDimensions=(this.userDefinedWidth>0||this.userDefinedHeight>0)&&void 0!==this.userDefinedWidth&&void 0!==this.userDefinedHeight,this.markBoundsDirty()}get height(){return this.userDefinedDimensions?this._height:this.getBounds().height}set height(t){const e=Math.max(0,t);this._height=e,this.userDefinedHeight=e,this.userDefinedDimensions=(this.userDefinedWidth>0||this.userDefinedHeight>0)&&void 0!==this.userDefinedWidth&&void 0!==this.userDefinedHeight,this.markBoundsDirty()}calculateBounds(){var t;if(this.userDefinedDimensions)return{x:this.x,y:this.y,width:this._width,height:this._height};if(!(null==(t=this.children)?void 0:t.length))return{x:this.x,y:this.y,width:0,height:0};let e=1/0,i=1/0,s=-1/0,o=-1/0;for(const t of this.children){const n=t.x,a=t.y,r=t.width,h=t.height,l=n-r/2,c=n+r/2,d=a-h/2,u=a+h/2;e=Math.min(e,l),s=Math.max(s,c),i=Math.min(i,d),o=Math.max(o,u)}const n=s-e,a=o-i;return{x:this.x,y:this.y,width:n,height:a}}getDebugBounds(){var t;const e=this.calculateBounds();let i=1/0,s=1/0;for(const t of this.children){const e=t.x,o=t.y,n=e-t.width/2,a=o-t.height/2;i=Math.min(i,n),s=Math.min(s,a)}return(null==(t=this.children)?void 0:t.length)||(i=this.x-e.width/2,s=this.y-e.height/2),{width:e.width,height:e.height,x:i,y:s}}}class xt extends ft{constructor(t={}){super(t)}draw(){super.draw(),this.drawRect()}drawRect(){const t=-this.width/2,e=-this.height/2;this.color&&ht.shapes.rect(t,e,this.width,this.height,this.color),this.stroke&&ht.shapes.outlineRect(t,e,this.width,this.height,this.stroke,this.lineWidth)}}class Mt extends ft{constructor(t,e={}){super(e),this._text=t,this._font=e.font||"12px monospace",this._color=e.color||"yellow",this._align=e.align||"center",this._baseline=e.baseline||"middle",this._calculateBounds(),this._calculateAlignmentOffsets()}draw(){super.draw(),this.logger.log("draw",this.font,this.color,this.opacity),ht.text.setFont(this.font),ht.text.setTextAlign(this.align),ht.text.setTextBaseline(this.baseline),ht.text.fillText(this.text,0,0,this.color)}_calculateAlignmentOffsets(){if(!ht.text)return;const t=ht.text.measureTextDimensions(this.text,this.font);switch(this._align){case"left":this._centerOffsetX=t.width/2;break;case"center":this._centerOffsetX=0;break;case"right":this._centerOffsetX=-t.width/2-5}switch(this._baseline){case"top":this._centerOffsetY=t.height/4;break;case"middle":this._centerOffsetY=-2;break;case"bottom":this._centerOffsetY=-t.height}}getTextBounds(){if(ht.text){const t=ht.text.measureTextDimensions(this.text,this.font),e=2;return{x:this._centerOffsetX-t.width/2,y:this._centerOffsetY-t.height/2,width:t.width+2*e,height:t.height+2*e}}return{x:this._centerOffsetX,y:this._centerOffsetY,width:this._width,height:this._height}}_calculateBounds(){if(ht.text){const t=ht.text.measureTextDimensions(this.text,this.font);this._width=t.width,this._height=t.height,this._calculateAlignmentOffsets()}else this._width=this.text?8*this.text.length:0,this._height=16;this.trace("TextShape.calculateBounds: "+this._width+"x"+this._height)}getDebugBounds(){const t=this.getTextBounds();return{x:t.x,y:t.y,width:t.width,height:t.height}}checkDirty(t,e){t!==e&&(this._boundsDirty=!0,this._calculateBounds())}get text(){return this._text}set text(t){this.checkDirty(t,this._text),this._text=t}get font(){return this._font}set font(t){this.checkDirty(t,this._font),this._font=t}get color(){return this._color}set color(t){this._color=t}get align(){return this._align}set align(t){this.checkDirty(t,this._align),this._align=t}get baseline(){return this._baseline}set baseline(t){this.checkDirty(t,this._baseline),this._baseline=t}}class wt{constructor(){this.listeners={}}on(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}off(t,e){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter((t=>t!==e)))}emit(t,e){this.listeners[t]&&this.listeners[t].forEach((t=>t(e)))}}const yt=class t{static init(e){t.game=e,t.x=0,t.y=0,t.down=!1,e.events.on("mousedown",t._onDown),e.events.on("mouseup",t._onUp),e.events.on("mousemove",t._onMove),e.events.on("touchstart",t._onTouchStart),e.events.on("touchend",t._onTouchEnd),e.events.on("touchmove",t._onTouchMove)}static _setPosition(e,i){t.x=e,t.y=i}};T(yt,"_onDown",(t=>{yt.down=!0,yt._setPosition(t.offsetX,t.offsetY),yt.game.events.emit("inputdown",t)})),T(yt,"_onUp",(t=>{yt.down=!1,yt._setPosition(t.offsetX,t.offsetY),yt.game.events.emit("inputup",t)})),T(yt,"_onMove",(t=>{yt._setPosition(t.offsetX,t.offsetY),yt.game.events.emit("inputmove",t)})),T(yt,"_onTouchStart",(t=>{const e=t.touches[0],i=yt.game.canvas.getBoundingClientRect();yt.down=!0,yt._setPosition(e.clientX-i.left,e.clientY-i.top),yt.game.events.emit("inputdown",t)})),T(yt,"_onTouchEnd",(t=>{yt.down=!1,yt.game.events.emit("inputup",t)})),T(yt,"_onTouchMove",(t=>{const e=t.touches[0],i=yt.game.canvas.getBoundingClientRect();yt._setPosition(e.clientX-i.left,e.clientY-i.top),yt.game.events.emit("inputmove",t)}));let bt=yt;const _t=class t{static init(e){t.game=e,t.canvas=e.canvas,t.x=0,t.y=0,t.leftDown=!1,t.middleDown=!1,t.rightDown=!1,t.canvas.addEventListener("mousemove",t._onMove),t.canvas.addEventListener("mousedown",t._onDown),t.canvas.addEventListener("mouseup",t._onUp),t.canvas.addEventListener("click",t._onClick),t.canvas.addEventListener("wheel",t._onWheel)}static _updatePosition(e){const i=t.canvas.getBoundingClientRect();t.x=e.clientX-i.left,t.y=e.clientY-i.top}};T(_t,"_onMove",(t=>{_t._updatePosition(t),_t.game.events.emit("mousemove",t)})),T(_t,"_onDown",(t=>{_t._updatePosition(t),0===t.button&&(_t.leftDown=!0),1===t.button&&(_t.middleDown=!0),2===t.button&&(_t.rightDown=!0),_t.game.events.emit("mousedown",t)})),T(_t,"_onUp",(t=>{_t._updatePosition(t),0===t.button&&(_t.leftDown=!1),1===t.button&&(_t.middleDown=!1),2===t.button&&(_t.rightDown=!1),_t.game.events.emit("mouseup",t)})),T(_t,"_onClick",(t=>{_t._updatePosition(t),_t.game.events.emit("click",t)})),T(_t,"_onWheel",(t=>{_t._updatePosition(t),_t.game.events.emit("wheel",t)}));let vt=_t;const kt=class t{static init(e){t.game=e,window.addEventListener("keydown",t._onKeyDown),window.addEventListener("keyup",t._onKeyUp)}static isDown(e){return t._down.has(e)}static _onKeyDown(e){const i=t._codeMap[e.code];i&&(t._down.has(i)||(t._down.add(i),t.game.events.emit(i,e))),t.game.events.emit(e.type,e)}static _onKeyUp(e){const i=t._codeMap[e.code];i&&t._down.has(i)&&(t._down.delete(i),t.game.events.emit(i+"_up",e)),t.game.events.emit(e.type,e)}};T(kt,"W","W"),T(kt,"A","A"),T(kt,"S","S"),T(kt,"D","D"),T(kt,"UP","UP"),T(kt,"DOWN","DOWN"),T(kt,"LEFT","LEFT"),T(kt,"RIGHT","RIGHT"),T(kt,"SPACE","SPACE"),T(kt,"SHIFT","SHIFT"),T(kt,"ENTER","ENTER"),T(kt,"ESC","ESC"),T(kt,"_codeMap",{KeyW:kt.W,KeyA:kt.A,KeyS:kt.S,KeyD:kt.D,ArrowUp:kt.UP,ArrowDown:kt.DOWN,ArrowLeft:kt.LEFT,ArrowRight:kt.RIGHT,Space:kt.SPACE,ShiftLeft:kt.SHIFT,ShiftRight:kt.SHIFT,Enter:kt.ENTER,NumpadEnter:kt.ENTER,Escape:kt.ESC}),T(kt,"_down",new Set),T(kt,"game",null);let Ct=kt;const Tt=class t{static init(e){t.game=e,t.canvas=e.canvas,t.x=0,t.y=0,t.active=!1,t.canvas.addEventListener("touchstart",t._onStart),t.canvas.addEventListener("touchend",t._onEnd),t.canvas.addEventListener("touchmove",t._onMove)}static _updatePosition(e){const i=t.canvas.getBoundingClientRect();t.x=e.clientX-i.left,t.y=e.clientY-i.top}};T(Tt,"_onStart",(t=>{t.touches.length>0&&(Tt.active=!0,Tt._updatePosition(t.touches[0]),Tt.game.events.emit("touchstart",t))})),T(Tt,"_onEnd",(t=>{Tt.active=!1,Tt.game.events.emit("touchend",t)})),T(Tt,"_onMove",(t=>{t.touches.length>0&&(Tt._updatePosition(t.touches[0]),Tt.game.events.emit("touchmove",t))}));let Pt=Tt;function It(t,e={}){var i;if(!(t&&t instanceof St))return console.warn("applyAnchor can only be applied to GameObject instances"),t;t._anchor={position:e.anchor??null,margin:e.anchorMargin??10,offsetX:e.anchorOffsetX??0,offsetY:e.anchorOffsetY??0,relative:e.anchorRelative??!1,setTextAlign:!1!==e.anchorSetTextAlign,lastUpdate:0};const s=null==(i=t.update)?void 0:i.bind(t);return t.update=function(e){const i=!0===t._anchor.relative&&t.parent?t.parent:t._anchor.relative;if(t._anchor.position&&(t.boundsDirty||i&&i.boundsDirty||t.parent&&t.parent.boundsDirty)){let e;if(i){const s={x:i.x,y:i.y,width:i.width,height:i.height};e=A.calculate(t._anchor.position,t,s,t._anchor.margin,t._anchor.offsetX,t._anchor.offsetY)}else e=A.calculateAbsolute(t._anchor.position,t,t.game,t._anchor.margin,t._anchor.offsetX,t._anchor.offsetY);!t.parent||(o=t).game&&o.game.pipeline&&o.game.pipeline.gameObjects&&o.game.pipeline.gameObjects.includes(o)?(t.x=e.x,t.y=e.y):i===t.parent?(t.x=e.x-i.x,t.y=e.y-i.y):(t.x=e.x-t.parent.x,t.y=e.y-t.parent.y),t._anchor.setTextAlign&&("align"in t&&(t.align=e.align),"baseline"in t&&(t.baseline=e.baseline)),t._anchor.lastUpdate=t.game?t.game.lastTime:Date.now()}var o;s&&s(e)},t}class St extends pt{constructor(t,e={}){super(e),this.game=t,this.parent=null,this.events=new wt,this._interactive=e.interactive??!1,this._hovered=!1,e.anchor&&It(this,e)}update(t){this.logger.groupCollapsed("GameObject.update: "+(null==this.name?this.constructor.name:this.name)),super.update(t),this.logger.groupEnd()}get interactive(){return this._interactive}set interactive(t){const e=Boolean(t);this._interactive!==e&&(this._interactive=e,!0===e?this._enableEvents():(this._disableEvents(),this._hovered&&(this._hovered=!1,this.events.emit("mouseout"))))}_enableEvents(){this.logger.log(`${this.constructor.name} is now interactive`)}_disableEvents(){this.logger.log(`${this.constructor.name} is no longer interactive`)}get hovered(){return this._hovered}set hovered(t){this._hovered=Boolean(t)}_setHovered(t){this._hovered=Boolean(t)}_hitTest(t,e){var i;if(!this._interactive)return!1;if(!(null==(i=this.getBounds)?void 0:i.call(this)))return!1;let s=t,o=e;const n=[];let a=this;for(;a;)n.unshift(a),a=a.parent;for(const t of n){if(s-=t.x||0,o-=t.y||0,t.rotation){const e=Math.cos(-t.rotation),i=Math.sin(-t.rotation),n=s;s=n*e-o*i,o=n*i+o*e}void 0!==t.scaleX&&0!==t.scaleX&&(s/=t.scaleX),void 0!==t.scaleY&&0!==t.scaleY&&(o/=t.scaleY)}const r=this.width/2,h=this.height/2;return s>=-r&&s<=r&&o>=-h&&o<=h}on(t,e){this.events.on(t,e)}off(t,e){this.events.off(t,e)}emit(t,...e){this.events.emit(t,...e)}}class Bt extends St{constructor(t,e,i={}){if(super(t,i),!e||null==e||null==e)throw new Error("GameObjectShapeWrapper requires a shape");this.shape=e,void 0!==i.color&&(e.color=i.color),void 0!==i.stroke&&(e.stroke=i.stroke),void 0!==i.lineWidth&&(e.lineWidth=i.lineWidth),void 0!==i.lineJoin&&(e.lineJoin=i.lineJoin),void 0!==i.lineCap&&(e.lineCap=i.lineCap),void 0!==i.miterLimit&&(e.miterLimit=i.miterLimit),this.syncPropertiesToShape(),this.logger.log(`Created GameObject(${this.constructor.name}):`,{x:this.x,y:this.y,width:this.width,height:this.height,color:this.color,stroke:this.stroke})}syncPropertiesToShape(){if(!this.shape)return;const t=["width","height","rotation","scaleX","scaleY","visible","debug","debugColor"];for(const e of t)e in this&&e in this.shape&&this[e]!==this.shape[e]&&(this.shape[e]=this[e])}get color(){return this.shape?this.shape.color:null}set color(t){this.shape&&(this.shape.color=t)}get stroke(){return this.shape?this.shape.stroke:null}set stroke(t){this.shape&&(this.shape.stroke=t)}get lineWidth(){return this.shape?this.shape.lineWidth:1}set lineWidth(t){this.shape&&(this.shape.lineWidth=t)}get lineJoin(){return this.shape?this.shape.lineJoin:"miter"}set lineJoin(t){this.shape&&(this.shape.lineJoin=t)}get lineCap(){return this.shape?this.shape.lineCap:"butt"}set lineCap(t){this.shape&&(this.shape.lineCap=t)}get miterLimit(){return this.shape?this.shape.miterLimit:10}set miterLimit(t){this.shape&&(this.shape.miterLimit=t)}update(t){var e;this.active&&(null==(e=this.onUpdate)||e.call(this,t),(this._boundsDirty||this.tweening)&&(this.syncPropertiesToShape(),this._boundsDirty=!1),super.update(t))}draw(){super.draw(),this.shape.render()}}class Dt extends St{constructor(t,e={}){super(t,e),this._collection=new O({sortByZIndex:e.sortByZIndex||!0}),this._collection._owner=this,this._width=e.width??0,this._height=e.height??0,this.forceWidth=null,this.forceHeight=null,this._naturalWidth=null,this._naturalHeight=null,this.userDefinedDimensions=!1,null!=e.width&&null!=e.height&&(this.userDefinedWidth=e.width,this.userDefinedHeight=e.height,this.userDefinedDimensions=!0)}update(t){this.logger.groupCollapsed("Scene.update: "+(null==this.name?this.constructor.name:this.name));for(let e=0;e<this.children.length;e++){const i=this.children[e];i.active&&i.update&&i.update(t)}super.update(t),this.logger.groupEnd()}add(t){if(null==t||null==t)throw new Error("GameObject is null or undefined");return null!=t.parent&&console.warn("This GameObject already has a parent. Consider removing it first."),t.parent=this,this._collection.add(t),this.markBoundsDirty(),t.init&&t.init(),t}markBoundsDirty(){super.markBoundsDirty(),this.children.forEach((t=>{t.markBoundsDirty()}))}remove(t){const e=this._collection.remove(t);return e&&(t.parent=null,this.markBoundsDirty()),e}draw(){super.draw(),this.logger.log("Scene.draw chilren:"),this._collection.getSortedChildren().filter((t=>t.visible)).map((function(t){return ht.save(),t.render(),ht.restore(),t}))}getDebugBounds(){return{width:this.width,height:this.height,x:this.x-this.width/2,y:this.y-this.height/2}}bringToFront(t){return this._collection.bringToFront(t)}sendToBack(t){return this._collection.sendToBack(t)}bringForward(t){return this._collection.bringForward(t)}sendBackward(t){return this._collection.sendBackward(t)}clear(){return this._collection.children.forEach((t=>this.remove(t))),this._collection.clear()}get children(){return this._collection.children}}class Ot extends Dt{constructor(t,e={}){super(t,e),this.spacing=e.spacing??10,this.padding=e.padding??0,this.autoSize=e.autoSize??!0,this.align=e.align??"start",this.debug=e.debug??!1,this._layoutDirty=!0}calculateLayout(){throw new Error("Subclasses must implement calculateLayout()")}update(t){if(this._boundsDirty||this._layoutDirty){const t=this.width,e=this.height,i=this.calculateLayout();this.autoSize&&i&&(Math.abs(this.width-i.width)>.1&&(this.width=i.width),Math.abs(this.height-i.height)>.1&&(this.height=i.height)),i&&i.positions&&this.applyPositionsToChildren(i.positions),this._boundsDirty=!1,this._layoutDirty=!1,t===this.width&&e===this.height||this._updatingBoundsFromLayout||(this._updatingBoundsFromLayout=!0,Dt.prototype.markBoundsDirty.call(this),this._updatingBoundsFromLayout=!1)}super.update(t)}markBoundsDirty(){this._updatingBoundsFromLayout?this._boundsDirty=!0:(super.markBoundsDirty(),this._layoutDirty=!0)}applyPositionsToChildren(t){W(this.children,t,this.getLayoutOffset())}getLayoutOffset(){return{offsetX:0,offsetY:0}}add(t){const e=super.add(t);return this._layoutDirty=!0,e}remove(t){const e=super.remove(t);return this._layoutDirty=!0,e}}class Et extends Bt{constructor(t,e,i={}){super(t,new Mt(e,{font:i.font||"16px monospace",color:i.color||"yellow",align:i.align||"left",baseline:i.baseline||"top",strokeColor:i.strokeColor||"#000",lineWidth:i.lineWidth||1,debugColor:i.debugColor||"yellow"}),i),this._textOptions={font:i.font||"16px monospace",color:i.color||"yellow",align:i.align||"left",baseline:i.baseline||"top"}}get text(){return this.shape.text}set text(t){this.shape.text=t,this.markBoundsDirty()}get font(){return this.shape.font}set font(t){this.shape.font=t,this._textOptions.font=t,this.markBoundsDirty()}get color(){return this.shape.color}set color(t){this.shape.color=t,this._textOptions.color=t}get align(){return this.shape.align}set align(t){this.shape.align=t,this._textOptions.align=t,this.markBoundsDirty()}get baseline(){return this.shape.baseline}set baseline(t){this.shape.baseline=t,this._textOptions.baseline=t,this.markBoundsDirty()}measureWidth(){return ht.ctx?ht.text.measureTextWidth(this.text,this.font):0}measureHeight(){if(!this.font)return 16;const t=parseInt(this.font);return isNaN(t)?16:t}getBounds(){const t=super.getBounds();if(this.shape.getTextBounds){const t=this.shape.getTextBounds();return{x:this.x,y:this.y,width:t.width,height:t.height}}return t}update(t){super.update(t),this.shape&&(this.width=this.shape.width||this.measureWidth(),this.height=this.shape.height||this.measureHeight())}}class At extends ft{constructor(t,e={}){if(!t&&!e.width&&!e.height)throw new Error("ImageShape must be initialized with either a bitmap or width and height");super(e),this._bitmap=t??ht.img.createImageData(e.width,e.height),this._width=e.width??(null==t?void 0:t.width)??0,this._height=e.height??(null==t?void 0:t.height)??0,this.anchor=e.anchor??"center",this._anchorX=.5,this._anchorY=.5,this._updateAnchorOffsets(),this.smoothing=!1!==e.smoothing,t instanceof ImageData&&this.buffer(t)}_updateAnchorOffsets(){var t;const e=(null==(t=this.anchor)?void 0:t.toLowerCase())??"center";e.includes("left")?this._anchorX=0:e.includes("right")?this._anchorX=1:this._anchorX=.5,e.includes("top")?this._anchorY=0:e.includes("bottom")?this._anchorY=1:this._anchorY=.5}get bitmap(){return this._bitmap}set bitmap(t){t&&(this._bitmap=t,!this._width&&t.width&&(this._width=t.width),!this._height&&t.height&&(this._height=t.height),t instanceof ImageData&&this.buffer(t))}buffer(t){t&&(this._buffer||(this._buffer=document.createElement("canvas")),this._buffer.width===t.width&&this._buffer.height===t.height||(this._buffer.width=t.width,this._buffer.height=t.height),this._buffer.getContext("2d").putImageData(t,0,0))}reset(){this._buffer=null,this._bitmap=ht.img.createImageData(this.width,this.height)}setAnchor(t){this.anchor=t,this._updateAnchorOffsets()}draw(){if(!this.visible)return;if(!this._bitmap&&!this._buffer)return;super.draw();let t=this._bitmap instanceof ImageData?this._buffer:this._bitmap;(!t||this._bitmap instanceof ImageData&&!this._buffer)&&(this._bitmap instanceof ImageData&&(this.buffer(this._bitmap),t=this._buffer),!t)||ht.img.draw(t,0,0,{width:this.width,height:this.height,anchor:this.anchor,rotation:this.rotation,scaleX:this.scaleX,scaleY:this.scaleY,alpha:this.opacity,smoothing:this.smoothing,flipX:this.scaleX<0,flipY:this.scaleY<0})}calculateBounds(){return{x:-this._anchorX*this.width,y:-this._anchorY*this.height,width:this.width,height:this.height}}}class Wt{static lerp(t,e,i){return t+(e-t)*i}static lerpAngle(t,e,i){let s=e-t;for(;s<-Math.PI;)s+=2*Math.PI;for(;s>Math.PI;)s-=2*Math.PI;return t+s*i}static tweenColor(t,e,i){return t.map(((t,s)=>Wt.lerp(t,e[s],i)))}static tweenGradient(t,e,i){let s=t[0],o=e[0];return Math.abs(o-s)>180&&(s<o?s+=360:o+=360),[Wt.lerp(s,o,i)%360,Wt.lerp(t[1],e[1],i),Wt.lerp(t[2],e[2],i)]}}class Rt{static easeInQuad(t){return t*t}static easeOutQuad(t){return t*(2-t)}static easeInOutQuad(t){return t<.5?2*t*t:(4-2*t)*t-1}static easeInCubic(t){return t*t*t}static easeOutCubic(t){return--t*t*t+1}static easeInOutCubic(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}static easeInQuart(t){return t*t*t*t}static easeOutQuart(t){return 1- --t*t*t*t}static easeInOutQuart(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t}static easeInSine(t){return 1-Math.cos(t*Math.PI/2)}static easeOutSine(t){return Math.sin(t*Math.PI/2)}static easeInOutSine(t){return-(Math.cos(Math.PI*t)-1)/2}static easeInExpo(t){return 0===t?0:Math.pow(2,10*(t-1))}static easeOutExpo(t){return 1===t?1:1-Math.pow(2,-10*t)}static easeInOutExpo(t){return 0===t||1===t?t:t<.5?.5*Math.pow(2,20*t-10):.5*(2-Math.pow(2,-20*t+10))}static easeInCirc(t){return 1-Math.sqrt(1-t*t)}static easeOutCirc(t){return Math.sqrt(1- --t*t)}static easeInOutCirc(t){return t<.5?.5*(1-Math.sqrt(1-4*t*t)):.5*(Math.sqrt(-(2*t-3)*(2*t-1))+1)}static easeInElastic(t,e=1,i=.3){if(0===t||1===t)return t;const s=i/(2*Math.PI)*Math.asin(1/e);return-e*Math.pow(2,10*(t-1))*Math.sin((t-1-s)*(2*Math.PI)/i)}static easeOutElastic(t,e=1,i=.3){if(0===t||1===t)return t;const s=i/(2*Math.PI)*Math.asin(1/e);return e*Math.pow(2,-10*t)*Math.sin((t-s)*(2*Math.PI)/i)+1}static easeInOutElastic(t,e=1,i=.3){if(0===t||1===t)return t;const s=i/(2*Math.PI)*Math.asin(1/e);return t<.5?e*Math.pow(2,10*(2*t-1))*Math.sin((2*t-1-s)*(2*Math.PI)/i)*-.5:e*Math.pow(2,-10*(2*t-1))*Math.sin((2*t-1-s)*(2*Math.PI)/i)*.5+1}static easeInBack(t,e=1.70158){return t*t*((e+1)*t-e)}static easeOutBack(t,e=1.70158){return--t*t*((e+1)*t+e)+1}static easeInOutBack(t,e=1.70158){const i=1.525*e;return t<.5?2*t*.5*(2*t)*(2*(i+1)*t-i):.5*((2*t-2)*(2*t-2)*((i+1)*(2*t-2)+i)+2)}static easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static easeInBounce(t){return 1-Rt.easeOutBounce(1-t)}static easeInOutBounce(t){return t<.5?.5*Rt.easeInBounce(2*t):.5*Rt.easeOutBounce(2*t-1)+.5}}function zt(t,e,i,s,o,n=!1,a=null,r={},h=null){const{t:l,easedT:c,completed:d,state:u}=Kt._frame(s,o,n,a,r,h),g=1/(i+1),p=Math.min(Math.floor(c/g),i),f=c%g/g,m=t*Math.pow(.6,p),x=e-Math.sin(f*Math.PI)*(e-m);return Kt.animationResult({y:x,segment:p,bounceHeight:m},l,n,d,u)}function Lt(t,e,i,s,o,n,a=!0,r=null,h={},l=null){if(i<=0)return Kt.animationResult({x:t.x,y:t.y,moving:!1},1,!1,!0);l||(l={initialX:t.x,initialY:t.y,started:!1,completed:!1,loopCount:0});const c=l.initialX,d=l.initialY,{t:u,easedT:g,completed:p,state:f}=Kt._frame(e,i,a,r,h,l);l={...l,...f};const m=e*s,x=Math.max(0,Math.min(1,o)),M=c+(Math.sin(.7*m)+.4*x*Math.sin(2.3*m+.5))*n,w=d+(Math.cos(.9*m)+.4*x*Math.cos(1.9*m+.7))*n,y=.7*Math.cos(.7*m)+.4*x*2.3*Math.cos(2.3*m+.5),b=-.9*Math.sin(.9*m)+.4*x*-1.9*Math.sin(1.9*m+.7),_=Math.sqrt(y*y+b*b),v=_>.8,k=Math.sqrt((M-c)*(M-c)+(w-d)*(w-d));return Kt.animationResult({x:M,y:w,centerX:c,centerY:d,offsetX:M-c,offsetY:w-d,distance:k,moving:v,velocity:_},u,a,p,l)}function Yt(t,e=!1,i,s,o=!1,n=null,a={},r=null){if(!t||t.length<2)return this._createResult({x:0,y:0},0,o,!1);const{t:h,easedT:l,completed:c,state:d}=Kt._frame(i,s,o,n,a,r);if(!r||!r.pathData){const i={segmentLengths:[],totalLength:0,points:[...t]};for(let e=0;e<t.length-1;e++){const s=t[e],o=t[e+1],n=o[0]-s[0],a=o[1]-s[1],r=Math.sqrt(n*n+a*a);i.segmentLengths.push(r),i.totalLength+=r}if(e){const e=t[t.length-1],s=t[0],o=s[0]-e[0],n=s[1]-e[1],a=Math.sqrt(o*o+n*n);i.segmentLengths.push(a),i.totalLength+=a}d.pathData=i}const{segmentLengths:u,totalLength:g,points:p}=d.pathData,f=l*g;let m=0,x=0;for(let t=0;t<u.length;t++){if(m+u[t]>=f){x=t;break}m+=u[t]}const M=(f-m)/u[x],w=p[x],y=x<p.length-1?p[x+1]:p[0],b=Wt.lerp(w[0],y[0],M),_=Wt.lerp(w[1],y[1],M),v=Math.atan2(y[1]-w[1],y[0]-w[0]);return Kt.animationResult({x:b,y:_,angle:v,segmentIndex:x,segmentProgress:M,pathProgress:l},h,o,c,d)}function Ft(t,e,i,s,o,n,a,r=!0,h=!0,l=null,c={},d=null){const{t:u,easedT:g,completed:p,state:f}=Kt._frame(n,a,r,l,c,d),m=o+(h?1:-1)*g*Math.PI*2,x=t+i*Math.cos(m),M=e+s*Math.sin(m);return Kt.animationResult({x:x,y:M,angle:m},u,r,p,f)}function Xt(t,e,i,s,o=!0,n=null,a={},r=null){const{t:h,easedT:l,completed:c,state:d}=Kt._frame(i,s,o,n,a,r),u=(e-t)/2,g=t+u+u*Math.sin(l*Math.PI*2);return Kt.animationResult({value:g},h,o,c,d)}function Ht(t,e,i,s,o,n=!1,a=!1,r=null,h={},l=null){l||(l={started:!1,loopCount:0,direction:1,lastDirection:1,completed:!1});let c=o>0?s/o:1,d=!1,u={...h};if(a||n)if(n)if(a){const t=2*o,e=s%t,i=Math.floor(s/t),n=e<o?1:-1;c=1===n?e/o:2-e/o,n!==l.direction&&(l.direction=n,1===l.direction&&u.onLoop&&u.onLoop(i)),i>l.loopCount&&(l.loopCount=i)}else{c%=1;const t=Math.floor(s/o);t>l.loopCount&&u.onLoop&&(u.onLoop(t),l.loopCount=t)}else a&&!n&&(c<=1?l.direction=1:c<=2?(c=2-c,l.direction=-1):(c=0,d=!0,l.direction=1));else c>=1&&(c=1,d=!0);!l.started&&u.onStart&&(u.onStart(),l.started=!0),d&&!l.completed&&u.onComplete&&(u.onComplete(),l.completed=!0);const g=r?r(c):c,p=(t+i-2*e)*g*g+2*(e-t)*g+t,f={...l,lastDirection:l.direction,completed:d||l.completed};return Kt.animationResult({value:p,direction:l.direction},c,n||a&&!d,d,f)}function Gt(t,e,i,s,o,n,a=!0,r=null){r||(r={currentX:t,currentY:e,targetX:t,targetY:e,isWaiting:!0,waitStartTime:0,moveStartTime:0,moveCount:0,direction:"idle"});const h=()=>Math.random();let l=r.isWaiting,c=r.currentX,d=r.currentY,u=r.direction;if(l){if(i-r.waitStartTime>=o){l=!1,r.moveStartTime=i,u=["up","down","left","right"][Math.floor(4*h())];let s=r.currentX,o=r.currentY;const a=n*(.2+.6*h());switch(u){case"up":o=r.currentY-a;break;case"down":o=r.currentY+a;break;case"left":s=r.currentX-a;break;case"right":s=r.currentX+a}Math.pow(s-t,2)+Math.pow(o-e,2)>n*n&&("up"===u||"down"===u?(o=e,u=r.currentY>e?"up":"down"):(s=t,u=r.currentX>t?"left":"right")),r.targetX=s,r.targetY=o,r.direction=u,r.moveCount++}}else{const t=(i-r.moveStartTime)/s;t>=1?(l=!0,r.waitStartTime=i,r.currentX=r.targetX,r.currentY=r.targetY,u="idle"):(c=r.currentX+(r.targetX-r.currentX)*t,d=r.currentY+(r.targetY-r.currentY)*t)}r.isWaiting=l,r.direction=u,l||(r.currentX=c,r.currentY=d);const g=s+o,p=i%g/g,f=Math.sqrt(Math.pow(c-t,2)+Math.pow(d-e,2));return Kt.animationResult({x:c,y:d,moving:!l,direction:u,distanceFromCenter:f},p,a,!1,r)}function Nt(t,e,i,s,o=!0,n=!1,a=null,r={},h=null){const{t:l,easedT:c,completed:d,state:u}=Kt._frame(i,s,o,null,r,h),g=n&&!o?Math.exp(-4*l):1;let p=t+e*Math.cos(2*c*Math.PI)*g;return a&&(p=t+a(((p-t)/(e*g)+1)/2)*e*g*2-e*g),Kt.animationResult({angle:p},l,o,d,u)}function Ut(t,e,i,s,o=!0,n=!1,a=null,r={}){let h,l=i/s,c="forward";if(o){const t=Math.floor(l);l%=1,t>0&&r.onLoop&&r.onLoop(t)}else l>1&&(l=1);if(l>0&&i<=s&&r.onStart&&r.onStart(),n)if(l<.5){const i=2*l;h=t+(e-t)*(a?a(i):i),c="forward"}else{const i=2*(l-.5);h=e-(e-t)*(a?a(i):i),c="return",l>=.5&&l<.51&&r.onYoyoTurn&&r.onYoyoTurn()}else{const i=a?a(l):l;h=t+(e-t)*(i<.5?2*i:2-2*i)}const d=!o&&l>=1;return d&&r.onComplete&&r.onComplete(),Kt.animationResult({value:h,phase:c},l,o,d)}function Zt(t,e,i,s,o=!0,n=!0,a=null,r={},h=null){const{t:l,easedT:c,completed:d,state:u}=Kt._frame(i,s,o,a,r,h,n);let g=0;g=o||n?n?Math.sin(c*Math.PI):Math.sin(Math.min(l,1)*Math.PI*.5):d?1:Math.sin(Math.min(l,1)*Math.PI*.5);const p=t-e*g;return Kt.animationResult({y:p},l,o,d,u)}function $t(t,e,i,s,o,n,a,r,h=!1,l=null,c={},d=null){const{t:u,easedT:g,completed:p,state:f}=Kt._frame(a,r,h,l,c,d),m=Math.pow(1-g,n),x=g*Math.PI*2*o,M=g*Math.PI*2*o*1.3,w=m*i*(.6*Math.sin(x)+.3*Math.sin(2.5*x)+.1*Math.sin(5.6*x)),y=m*s*(.6*Math.cos(M)+.3*Math.cos(2.7*M)+.1*Math.cos(6.3*M));let b=t+w,_=e+y;if(g>.9){const i=(g-.9)/.1;b=t+w*(1-i),_=e+y*(1-i)}return Kt.animationResult({x:b,y:_,intensity:m},u,h,p,f)}function qt(t,e,i,s,o,n,a,r,h=!1,l=!1,c=null,d={},u=null){u||(u={started:!1,loopCount:0,direction:1,lastDirection:1});let g=r>0?a/r:1,p=!1,f={...d};if(l||h)if(h)if(l){const t=2*r,e=a%t,i=Math.floor(a/t),s=e<r?1:-1;g=1===s?e/r:2-e/r,s!==u.direction&&(u.direction=s,1===u.direction&&f.onLoop&&f.onLoop(i)),i>u.loopCount&&(u.loopCount=i)}else{g%=1;const t=Math.floor(a/r);t>u.loopCount&&f.onLoop&&(f.onLoop(t),u.loopCount=t)}else l&&!h&&(g<=1?u.direction=1:g<=2?(g=2-g,u.direction=-1):(g=0,p=!0,u.direction=1));else g>=1&&(g=1,p=!0);!u.started&&f.onStart&&(f.onStart(),u.started=!0),p&&!u.completed&&f.onComplete&&(f.onComplete(),u.completed=!0);const m=c?c(g):g,x=Wt.lerp(i,s,m),M=o+m*n*Math.PI*2,w=t+x*Math.cos(M),y=e+x*Math.sin(M),b={...u,lastDirection:u.direction};return Kt.animationResult({x:w,y:y,radius:x,angle:M,direction:u.direction},g,h||l&&!p,p,b)}function jt(t,e,i,s,o=!1,n=!1,a={},r={}){if(s<=0)return this.animationResult({value:e,velocity:0,done:!0,phase:"complete"},1,!1,!0);let h,l,c,d=i/s,u="forward",g=0;o?(g=Math.floor(d),d%=1,g>0&&r.onLoop&&r.onLoop(g)):d>1&&(d=1),d>0&&i<=s&&r.onStart&&r.onStart(),n?d>=.5?(h=t,l=e,c=2*(d-.5),u="return",d>=.5&&d<.51&&r.onYoyoTurn&&r.onYoyoTurn()):(h=e,l=t,c=2*d,u="forward"):(h=e,l=t,c=d);const p=void 0!==a.stiffness?a.stiffness:.3,f=void 0!==a.damping?a.damping:.6,m=Math.max(.1,1/(1.5*f)),x=Math.max(.1,.8/(1.5*p+.5));let M;if(c<.99)M=Rt.easeOutElastic(c,m,x);else{const t=(c-.99)/.01;M=Rt.easeOutElastic(.99,m,x)*(1-t)+1*t}const w=Wt.lerp(l,h,M),y=Math.min(c+.01,1);let b;if(y<.99)b=Rt.easeOutElastic(y,m,x);else{const t=(y-.99)/.01;b=Rt.easeOutElastic(.99,m,x)*(1-t)+1*t}const _=(Wt.lerp(l,h,b)-w)/.01*s,v=!o&&d>=1;return v&&r.onComplete&&r.onComplete(),Kt.animationResult({value:w,velocity:_,delta:"forward"===u?e-w:t-w,done:v,phase:u},d,o,v)}function Vt(t,e,i,s,o,n=!0,a=!0,r=null,h={},l=null){const{t:c,easedT:d,completed:u,state:g}=Kt._frame(s,o,n,r,h,l),p=(a?Math.sin(d*Math.PI*2):Math.sin(d*Math.PI))*i;return Kt.animationResult({angle:p},c,n,u,g)}function Jt(t,e,i,s,o,n=!0,a={},r=null){if(!i||!Array.isArray(i)||i.length<2)return console.warn("Patrol animation requires at least 2 waypoints"),Kt._createResult({x:0,y:0,moving:!1,direction:"idle",waypoint:0},0,!1,!0);r||(r={currentWaypoint:0,nextWaypoint:1,isWaiting:!0,waitStartTime:0,lastWaypointTime:0,lastWaypointReached:-1,completed:!1});let h=0;for(let t=0;t<i.length;t++){const e=(t+1)%i.length;if(!n&&t===i.length-1)break;const s=i[e][0]-i[t][0],o=i[e][1]-i[t][1];h+=Math.abs(s)+Math.abs(o)}const l=h/s+o*i.length;let c=e;c=n?e%l:Math.min(e,l);const d=c/l;let u,g,p,f=c,m=0,x=1,M=!0,w=0,y=0,b=!1;if(f<o)w=f/o,m=0,x=1,M=!0;else{f-=o;for(let t=0;t<i.length;t++){if(!n&&t===i.length-1){m=t,x=t,M=!0,w=1,b=!0;break}const e=(t+1)%i.length,h=i[e][0]-i[t][0],l=i[e][1]-i[t][1],c=(Math.abs(h)+Math.abs(l))/s;if(f<c){m=t,x=e,M=!1,y=f/c;break}if(f-=c,f<o){m=e,x=(e+1)%i.length,M=!0,w=f/o,r.lastWaypointReached!==m&&(a.onWaypointReached&&a.onWaypointReached(m),a.onWaitStart&&a.onWaitStart(m),r.lastWaypointReached=m);break}f-=o}}if(M||b)u=i[m][0],g=i[m][1],p="idle",!r.isWaiting&&M&&a.onWaitEnd&&a.onWaitEnd(m);else{const t=i[m],e=i[x],s=e[0]-t[0],o=e[1]-t[1],n=Math.abs(s)+Math.abs(o),a=Math.abs(s)/n;if(y<=a&&0!==s){const e=y/a;u=t[0]+s*e,g=t[1],p=s>0?"right":"left"}else{const i=(y-a)/(1-a);u=e[0],g=t[1]+o*i,p=o>0?"down":"up"}}return r.currentWaypoint=m,r.nextWaypoint=x,r.isWaiting=M,!r.completed&&b&&a.onPatrolComplete&&(a.onPatrolComplete(),r.completed=!0),Kt.animationResult({x:u,y:g,moving:!M,waiting:M,waitProgress:M?w:0,direction:p,waypoint:m,nextWaypoint:x},d,n,b,r)}class Kt{static animationResult(t,e,i,s=!1,o=null){return{...t,t:e,progress:e,loop:i,completed:s,state:o}}static _step(t,e,i,s={},o={started:!1,loopCount:0}){let n=e>0?t/e:1,a=!1;if(!(o=o||{started:!1,loopCount:0}).started&&s.onStart&&(s.onStart(),o.started=!0),i){n%=1;const i=Math.floor(t/e);i>o.loopCount&&s.onLoop&&(s.onLoop(i),o.loopCount=i)}else n>=1&&(n=1,a=!0,!o.completed&&s.onComplete&&(s.onComplete(),o.completed=!0));return{t:n,completed:a,state:o}}static _frame(t,e,i,s=null,o={},n=null){const{t:a,completed:r,state:h}=this._step(t,e,i,o,n);return{t:a,easedT:s?s(a):a,completed:r,state:h}}static oscillate(t,e,i,s,o=!0,n=null,a={},r=null){return Xt(t,e,i,s,o,n,a,r)}static parabolic(t,e,i,s,o,n=!1,a=!1,r=null,h={},l=null){return Ht(t,e,i,s,o,n,a,r,h,l)}static float(t,e,i,s,o,n,a=!0,r=null,h={},l=null){return Lt(t,e,i,s,o,n,a,r,h,l)}static spring(t,e,i,s,o=!1,n=!1,a={},r={}){return jt(t,e,i,s,o,n,a,r)}static swing(t,e,i,s,o,n=!0,a=!0,r=null,h={},l=null){return Vt(0,0,i,s,o,n,a,r,h,l)}static pendulum(t,e,i,s,o=!0,n=!1,a=null,r={},h=null){return Nt(t,e,i,s,o,n,a,r,h)}static pulse(t,e,i,s,o=!0,n=!1,a=null,r={}){return Ut(t,e,i,s,o,n,a,{})}static spiral(t,e,i,s,o,n,a,r,h=!1,l=!1,c=null,d={},u=null){return qt(t,e,i,s,o,n,a,r,h,l,c,d,u)}static orbit(t,e,i,s,o,n,a,r=!0,h=!0,l=null,c={},d=null){return Ft(t,e,i,s,o,n,a,r,h,l,c,d)}static bezier(t,e,i,s,o,n,a=!1,r=!1,h=null,l={},c=null){return Qt(t,e,i,s,o,n,a,r,h,l,c)}static bounce(t,e,i,s,o,n=!1,a=null,r={},h=null){return zt(t,e,i,s,o,n,a,r,h)}static shake(t,e,i,s,o,n,a,r,h=!1,l=null,c={},d=null){return $t(t,e,i,s,o,n,a,r,h,l,c,d)}static follow(t,e=!1,i,s,o=!1,n=null,a={},r=null){return Yt(t,e,i,s,o,n,a,r)}static waypoint(t,e,i,s,o,n=!0,a={},r=null){return Jt(0,e,i,s,o,n,a,r)}static patrol(t,e,i,s,o,n,a=!0,r=null){return Gt(t,e,i,s,o,n,a,r)}static hop(t,e,i,s,o=!0,n=!0,a=null,r={},h=null){return Zt(t,e,i,s,o,n,a,r,h)}static group(t,e,i,s,o=!1,n=null,a={},r=null){r||(r={started:!1,loopCount:0,animationStates:Array(t.length).fill(null)});const{t:h,easedT:l,completed:c,state:d}=this._frame(i,s,o,n,a,r),u={};for(let r=0;r<t.length;r++){const h=t[r],l=[...e[r]];h===this.parabolic||h===this.oscillate||h===this.pulse?(l[3]=i,l[4]=s,l[5]=o,void 0===l[6]&&(l[6]=n)):h===this.spring?(l[2]=i,l[3]=s,l[4]=o):h===this.spiral||h===this.bezier?(l[6]=i,l[7]=s,l[8]=o,void 0===l[9]&&(l[9]=n)):h===this.orbit?(l[5]=i,l[6]=s,l[7]=o,void 0===l[9]&&(l[9]=n)):h===this.bounce||h===this.shake?(l[6]=i,l[7]=s,l[8]=o,void 0===l[9]&&(l[9]=n)):h===this.followPath&&(l[2]=i,l[3]=s,l[4]=o,void 0===l[5]&&(l[5]=n)),l.push(a),l.push(d.animationStates[r]);const c=h.apply(this,l);d.animationStates[r]=c.state,u[`anim${r}`]=c}return this.animationResult(u,h,o,c,d)}static sequence(t,e,i,s,o=!1,n=null,a={},r=null,h=null){if(!h){h={started:!1,loopCount:0,animationStates:Array(t.length).fill(null),currentAnim:0,animStartTimes:[0],totalDuration:0};let e=0;for(let t=0;t<i.length;t++)e+=i[t],t<i.length-1&&h.animStartTimes.push(e);h.totalDuration=e}let l=s;if(o&&h.totalDuration>0){l=s%h.totalDuration;const t=Math.floor(s/h.totalDuration);t>h.loopCount&&a.onLoop&&(a.onLoop(t),h.loopCount=t)}!h.started&&a.onStart&&(a.onStart(),h.started=!0);let c=0;for(let e=t.length-1;e>=0;e--)if(l>=h.animStartTimes[e]){c=e;break}h.currentAnim=c;const d=l-h.animStartTimes[c],u=i[c],g=t[c],p=[...e[c]];g===this.parabolic||g===this.oscillate||g===this.pulse?(p[3]=d,p[4]=u,p[5]=!1,n&&n[c]&&(p[6]=n[c])):g===this.spring?(p[2]=d,p[3]=u,p[4]=!1):g===this.spiral||g===this.bezier?(p[6]=d,p[7]=u,p[8]=!1,n&&n[c]&&(p[9]=n[c])):g===this.orbit?(p[5]=d,p[6]=u,p[7]=!1,n&&n[c]&&(p[9]=n[c])):g===this.bounce||g===this.shake?(p[6]=d,p[7]=u,p[8]=!1,n&&n[c]&&(p[9]=n[c])):g===this.followPath&&(p[2]=d,p[3]=u,p[4]=!1,n&&n[c]&&(p[5]=n[c]));const f=r&&r[c]?r[c]:{},m=g.apply(this,[...p,f,h.animationStates[c]]);h.animationStates[c]=m.state;const x=!o&&l>=h.totalDuration;return x&&!h.completed&&a.onComplete&&(a.onComplete(),h.completed=!0),this.animationResult({...m,currentAnim:c,totalAnimations:t.length,sequenceProgress:Math.min(l/h.totalDuration,1)},l/h.totalDuration,o,x,h)}}function Qt(t,e,i,s,o,n,a=!1,r=!1,h=null,l={},c=null){if(n<=0)return Kt.animationResult({x:s[0],y:s[1],phase:"complete"},1,!1,!0);let d=o/n,u="forward",g=0;a?(g=Math.floor(d),d%=1,g>0&&l.onLoop&&l.onLoop(g)):d>1&&(d=1),d>0&&o<=n&&l.onStart&&l.onStart();let p=h?h(d):d;r&&(d>=.5?(p=1-2*(d-.5),u="return",d>=.5&&d<.51&&l.onYoyoTurn&&l.onYoyoTurn()):(p=2*d,u="forward"),p=h?h(p):p);const f=3*(e[0]-t[0]),m=3*(i[0]-e[0])-f,x=s[0]-t[0]-f-m,M=3*(e[1]-t[1]),w=3*(i[1]-e[1])-M,y=s[1]-t[1]-M-w,b=x*Math.pow(p,3)+m*Math.pow(p,2)+f*p+t[0],_=y*Math.pow(p,3)+w*Math.pow(p,2)+M*p+t[1],v=!a&&d>=1;return v&&l.onComplete&&l.onComplete(),Kt.animationResult({x:b,y:_,phase:u},d,a,v,c)}class te{constructor(t,e,i,s,o={}){this.target=t,this.toProps={...e},this.duration=i,this.easingFn=s||Rt.easeOutQuad,this.delay=o.delay||0,this.onStart=o.onStart||null,this.onComplete=o.onComplete||null,this.onUpdate=o.onUpdate||null,this._elapsed=0,this._started=!1,this._finished=!1,this._startProps={};for(const t in this.toProps)t in this.target&&(this._startProps[t]=this.target[t])}static to(t,e,i,s,o){const n=new te(t,e,i,s,o);return te._active.push(n),n}update(t){if(this._finished)return;if(this._elapsed+=t,this._elapsed<this.delay)return;const e=this._elapsed-this.delay,i=Math.min(e/this.duration,1);!this._started&&i>0&&(this._started=!0,this.onStart&&this.onStart());const s=this.easingFn(i);for(const t in this._startProps){const e=this._startProps[t],i=this.toProps[t];this.target[t]=Wt.lerp(e,i,s)}this.onUpdate&&this.onUpdate(),i>=1&&(this._finished=!0,this.onComplete&&this.onComplete())}static updateAll(t){for(const e of te._active)e.update(t);te._active=te._active.filter((t=>!t._finished))}}class ee extends J{constructor(t){super(),this.game=t,this._collection=new O,this._collection._owner=this,["inputdown","inputup","inputmove","click"].forEach((t=>{this.game.events.on(t,(e=>{this.dispatchInputEvent(t,e)}))}))}_hoverObject(t,e){if(!t.interactive||!t._hitTest)return;const i=t._hitTest(e.x,e.y);i&&!t._hovered?(t._hovered=!0,t.events.emit("mouseover",e)):!i&&t._hovered&&(t._hovered=!1,t.events.emit("mouseout",e))}_hoverScene(t,e){for(let i=t.children.length-1;i>=0;i--){const s=t.children[i];s instanceof Dt?this._hoverScene(s,e):this._hoverObject(s,e)}}dispatchInputEvent(t,e){var i;for(let s=this.gameObjects.length-1;s>=0;s--){const o=this.gameObjects[s];if(o instanceof Dt){if(this._dispatchToScene(o,t,e))break}else if(o.interactive&&(null==(i=o._hitTest)?void 0:i.call(o,e.x,e.y))){o.events.emit(t,e);break}}"inputmove"===t&&this._dispatchHover(e)}_dispatchHover(t){for(let e=this.gameObjects.length-1;e>=0;e--){const i=this.gameObjects[e];i instanceof Dt?this._hoverScene(i,t):this._hoverObject(i,t)}}_dispatchToScene(t,e,i){var s;for(let o=t.children.length-1;o>=0;o--){const n=t.children[o];if(n instanceof Dt){if(this._dispatchToScene(n,e,i))return!0}else if(n.interactive&&(null==(s=n._hitTest)?void 0:s.call(n,i.x,i.y)))return n.events.emit(e,i),!0}return!1}add(t){t.parent=this.game;const e=this._collection.add(t);return e.init&&e.init(),e}remove(t){null!=t?this._collection.remove(t):this.logger.warn("Cannot remove undefined or null object",t)}bringToFront(t){return this._collection.bringToFront(t)}sendToBack(t){return this._collection.sendToBack(t)}bringForward(t){return this._collection.bringForward(t)}sendBackward(t){return this._collection.sendBackward(t)}clear(){return this._collection.clear()}get gameObjects(){return this._collection.children}update(t){this.logger.groupCollapsed("Pipeline.update"),this._collection.children.filter((t=>t.active)).forEach((e=>e.update(t))),te.updateAll(t),this.logger.groupEnd()}render(){this.logger.groupCollapsed("Pipeline.render"),this._collection.getSortedChildren().filter((t=>t.visible)).filter((t=>t.active)).forEach((t=>t.render())),this.logger.groupEnd()}}_=new WeakMap,v=new WeakMap;class ie extends St{constructor(t,e={}){super(t,e);const{x:i=0,y:s=0,width:o=120,height:n=40,text:a="Button",font:r="14px monospace",textColor:h="#000",textAlign:l="center",textBaseline:c="middle",shape:d=null,label:u=null,onClick:g=null,onHover:p=null,onPressed:f=null,onRelease:m=null,padding:x=10,colorDefaultBg:M="#eee",colorDefaultStroke:w="#999",colorDefaultText:y="#333",colorHoverBg:b="#222",colorHoverStroke:_="#16F529",colorHoverText:v="#16F529",colorPressedBg:k="#111",colorPressedStroke:C="#00aaff",colorPressedText:T="#00aaff"}=e;this.x=i,this.y=s,this.width=o,this.height=n,this.padding=x,this.textAlign=l,this.textBaseline=c,this.initColorScheme({colorDefaultBg:M,colorDefaultStroke:w,colorDefaultText:y,colorHoverBg:b,colorHoverStroke:_,colorHoverText:v,colorPressedBg:k,colorPressedStroke:C,colorPressedText:T}),this.initBackground(d),this.initLabel(a,r,h,u),this.initGroup(),this.initEvents(g,p,f,m),this.setState("default")}initColorScheme(t){this.colors={default:{bg:t.colorDefaultBg,stroke:t.colorDefaultStroke,text:t.colorDefaultText},hover:{bg:t.colorHoverBg,stroke:t.colorHoverStroke,text:t.colorHoverText},pressed:{bg:t.colorPressedBg,stroke:t.colorPressedStroke,text:t.colorPressedText}}}initBackground(t){this.bg=t??new xt({width:this.width,height:this.height,color:this.colors.default.bg,stroke:this.colors.default.stroke,lineWidth:2})}initLabel(t,e,i,s){this.label=s??new Mt(t,{font:e,color:i,align:this.textAlign,baseline:this.textBaseline}),this.alignText()}alignText(){if(!this.label)return;const t=this.width/2,e=this.height/2;switch(this.textAlign){case"left":this.label.x=-t+this.padding;break;case"right":this.label.x=t-this.padding;break;default:this.label.x=0}switch(this.textBaseline){case"top":this.label.y=-e+this.padding;break;case"bottom":this.label.y=e-this.padding;break;default:this.label.y=0}}initGroup(){this.group=new mt,this.group.add(this.bg),this.group.add(this.label)}initEvents(t,e,i,s){this.interactive=!0,this.onHover=e,this.onPressed=i,this.onRelease=s,this.on("mouseover",this.setState.bind(this,"hover")),this.on("mouseout",this.setState.bind(this,"default")),this.on("inputdown",this.setState.bind(this,"pressed")),this.on("inputup",(()=>{"pressed"===this.state&&"function"==typeof t&&t(),this.setState("hover")}))}setState(t){var e,i,s;if(this.state!==t)switch(this.state=t,t){case"default":this.game.cursor&&setTimeout((()=>{this.game.cursor.activate()}),0),this.bg.color=this.colors.default.bg,this.bg.stroke=this.colors.default.stroke,this.label.color=this.colors.default.text,this.game.canvas.style.cursor="default",null==(e=this.onRelease)||e.call(this);break;case"hover":this.game.cursor&&this.game.cursor.deactivate(),this.bg.color=this.colors.hover.bg,this.bg.stroke=this.colors.hover.stroke,this.label.color=this.colors.hover.text,this.game.canvas.style.cursor="pointer",null==(i=this.onHover)||i.call(this);break;case"pressed":this.game.cursor&&this.game.cursor.deactivate(),this.bg.color=this.colors.pressed.bg,this.bg.stroke=this.colors.pressed.stroke,this.label.color=this.colors.pressed.text,this.game.canvas.style.cursor="pointer",null==(s=this.onPressed)||s.call(this)}}update(t){super.update(t),this._boundsDirty&&this.alignText()}get text(){return this.label.text}set text(t){this.label.text=t,this._boundsDirty=!0}setTextAlign(t){this.textAlign=t,this.label.align=t,this._boundsDirty=!0}setTextBaseline(t){this.textBaseline=t,this.label.baseline=t,this._boundsDirty=!0}setFont(t){this.label.font=t,this._boundsDirty=!0}resize(t,e){this.width=t,this.height=e,this.bg.width=t,this.bg.height=e,this._boundsDirty=!0}draw(){super.draw(),this.group.render()}}t.Arc=class extends ft{constructor(t,e,i,s={}){super(s),this.radius=t,this.startAngle=e,this.endAngle=i}draw(){super.draw(),ht.lines.beginPath(),ht.shapes.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this.stroke&&ht.colors.stroke(this.stroke,this.lineWidth)}getBounds(){const t=this.radius;return{x:this.x,y:this.y,width:2*t,height:2*t}}},t.Arrow=class extends ft{constructor(t,e={}){super(e),this.length=t}draw(){super.draw();const t=this.width/2,e=.4*this.length,i=this.length-e;ht.lines.beginPath(),ht.lines.moveTo(-i/2,-t),ht.lines.lineTo(i/2,-t),ht.lines.lineTo(i/2,-this.width),ht.lines.lineTo(this.length/2,0),ht.lines.lineTo(i/2,this.width),ht.lines.lineTo(i/2,t),ht.lines.lineTo(-i/2,t),ht.lines.closePath(),this.color&&ht.colors.fill(this.color),this.stroke&&ht.colors.stroke(this.stroke,this.lineWidth)}},t.BezierShape=class extends ft{constructor(t=[],e={}){super(e),this.path=t}draw(){super.draw(),ht.lines.path(this.path,this.color,this.stroke,this.lineWidth)}getBounds(){return{x:this.x,y:this.y,width:100,height:100}}},t.Button=ie,t.Circle=class extends ft{constructor(t,e={}){super(e),this._radius=t,this.width=2*t,this.height=2*t}draw(){super.draw(),this.color&&ht.shapes.fillCircle(0,0,this._radius,this.color),this.stroke&&ht.shapes.strokeCircle(0,0,this._radius,this.stroke,this.lineWidth)}calculateBounds(){const t=2*this._radius;return this.trace("Circle.calculateBounds:"+t),{x:this.x,y:this.y,width:t,height:t}}get radius(){return this._radius}set radius(t){this.validateProp(t,"radius"),t!=this._radius&&(this._radius=t,this.width=2*t,this.height=2*t,this._boundsDirty=!0,this.calculateBounds())}},t.Cloud=class extends ft{constructor(t,e,i=40,s={}){super(t,e,s),this.size=i}draw(){super.draw();const t=this.size,e=[["M",-t,0],["C",-t,-t,0,-t,0,0],["C",0,1.2*-t,1.2*t,-t,t,0],["C",1.5*t,.5*t,.5*t,1.2*t,0,t],["C",.8*-t,1.3*t,1.2*-t,.3*t,-t,0],["Z"]];ht.lines.path(e,this.fillColor,this.strokeColor,this.lineWidth)}getBounds(){const t=2*this.size;return{x:this.x,y:this.y,width:t,height:t}}},t.Complex=X,t.Cone=class extends ft{constructor(t=50,e=100,i={}){super(i),this.radius=t,this.height=e||i.height||100,this.segments=i.segments||24,this.bottomColor=i.bottomColor||"#eee",this.sideColor=i.sideColor||"#aaa",this.stroke=i.stroke||null,this.lineWidth=i.lineWidth||1,this.rotationX=i.rotationX||0,this.rotationY=i.rotationY||0,this.rotationZ=i.rotationZ||0,this.visibleFaces=i.visibleFaces||["bottom","side"]}setRotation(t,e,i){return this.rotationX=t,this.rotationY=e,this.rotationZ=i,this}rotate(t,e,i){return this.rotationX+=t,this.rotationY+=e,this.rotationZ+=i,this}draw(){super.draw();const t=this.radius,e=this.height/2,i=(t,e,i)=>{let s=e,o=i;e=s*Math.cos(this.rotationX)-o*Math.sin(this.rotationX);let n=t;return o=i=s*Math.sin(this.rotationX)+o*Math.cos(this.rotationX),t=n*Math.cos(this.rotationY)+o*Math.sin(this.rotationY),i=-n*Math.sin(this.rotationY)+o*Math.cos(this.rotationY),n=t,s=e,{x:t=n*Math.cos(this.rotationZ)-s*Math.sin(this.rotationZ),y:e=n*Math.sin(this.rotationZ)+s*Math.cos(this.rotationZ),z:i}},s=(t,e,s)=>{const o=i(t,e,s);return{x:(o.x-o.y)*Math.cos(Math.PI/6),y:(o.x+o.y)*Math.sin(Math.PI/6)-o.z,z:o.z}},o=s(0,0,e),n=[],a=2*Math.PI/this.segments;for(let i=0;i<this.segments;i++){const o=i*a,r=Math.cos(o)*t,h=Math.sin(o)*t;n.push(s(r,h,-e))}const r=[];for(let t=0;t<this.segments;t++){const e=(t+1)%this.segments;r.push({points:[o,n[t],n[e]],z:(o.z+n[t].z+n[e].z)/3})}const h=[];this.visibleFaces.includes("bottom")&&h.push({type:"bottom",points:[...n].reverse(),z:-e}),this.visibleFaces.includes("side")&&h.push(...r.map((t=>({type:"side",points:t.points,z:t.z})))),h.sort(((t,e)=>e.z-t.z));for(const t of h){const e="bottom"===t.type?this.bottomColor:this.sideColor;ht.shapes.polygon(t.points,e,this.stroke,this.lineWidth)}}getBounds(){const t=1.5*Math.max(2*this.radius,this.height);return{x:this.x-t/2,y:this.y-t/2,width:t,height:t}}},t.Cross=class extends ft{constructor(t,e,i={}){super(i),this.size=t,this.thickness=e,this.diagonal=i.diagonal||!1}draw(){super.draw();const t=this.size/2,e=this.thickness/2;this.diagonal?(ht.lines.beginPath(),ht.lines.moveTo(-t,-t+e),ht.lines.lineTo(-t+e,-t),ht.lines.lineTo(0,-e),ht.lines.lineTo(t-e,-t),ht.lines.lineTo(t,-t+e),ht.lines.lineTo(e,0),ht.lines.lineTo(t,t-e),ht.lines.lineTo(t-e,t),ht.lines.lineTo(0,e),ht.lines.lineTo(-t+e,t),ht.lines.lineTo(-t,t-e),ht.lines.lineTo(-e,0),ht.lines.closePath()):(ht.lines.beginPath(),ht.lines.moveTo(-e,-t),ht.lines.lineTo(e,-t),ht.lines.lineTo(e,-e),ht.lines.lineTo(t,-e),ht.lines.lineTo(t,e),ht.lines.lineTo(e,e),ht.lines.lineTo(e,t),ht.lines.lineTo(-e,t),ht.lines.lineTo(-e,e),ht.lines.lineTo(-t,e),ht.lines.lineTo(-t,-e),ht.lines.lineTo(-e,-e),ht.lines.closePath()),this.color&&ht.colors.fill(this.color),this.stroke&&ht.colors.stroke(this.stroke,this.lineWidth)}},t.Cube=class extends ft{constructor(t=50,e={}){super(e),this.size=t,this.faceTopColor=e.faceTopColor||"#eee",this.faceBottomColor=e.faceBottomColor||"#ccc",this.faceLeftColor=e.faceLeftColor||"#aaa",this.faceRightColor=e.faceRightColor||"#888",this.faceFrontColor=e.faceFrontColor||"#666",this.faceBackColor=e.faceBackColor||"#444",this.strokeColor=e.strokeColor||null,this.lineWidth=e.lineWidth||1,this.rotationX=e.rotationX||0,this.rotationY=e.rotationY||0,this.rotationZ=e.rotationZ||0,this.visibleFaces=e.visibleFaces||["top","left","right","front","back","bottom"]}setRotation(t,e,i){return this.rotationX=t,this.rotationY=e,this.rotationZ=i,this}rotate(t,e,i){return this.rotationX+=t,this.rotationY+=e,this.rotationZ+=i,this}draw(){super.draw();const t=this.size/2,e=(t,e,i)=>{let s=e,o=i;e=s*Math.cos(this.rotationX)-o*Math.sin(this.rotationX);let n=t;return o=i=s*Math.sin(this.rotationX)+o*Math.cos(this.rotationX),t=n*Math.cos(this.rotationY)+o*Math.sin(this.rotationY),i=-n*Math.sin(this.rotationY)+o*Math.cos(this.rotationY),n=t,s=e,{x:t=n*Math.cos(this.rotationZ)-s*Math.sin(this.rotationZ),y:e=n*Math.sin(this.rotationZ)+s*Math.cos(this.rotationZ),z:i}},i=(t,i,s)=>{const o=e(t,i,s);return{x:(o.x-o.y)*Math.cos(Math.PI/6),y:(o.x+o.y)*Math.sin(Math.PI/6)-o.z}},s={p0:i(-t,-t,-t),p1:i(t,-t,-t),p2:i(t,t,-t),p3:i(-t,t,-t),p4:i(-t,-t,t),p5:i(t,-t,t),p6:i(t,t,t),p7:i(-t,t,t)},o={top:{points:[s.p4,s.p5,s.p6,s.p7],color:this.faceTopColor,normal:[0,0,1]},bottom:{points:[s.p0,s.p1,s.p2,s.p3],color:this.faceBottomColor,normal:[0,0,-1]},left:{points:[s.p0,s.p4,s.p7,s.p3],color:this.faceLeftColor,normal:[-1,0,0]},right:{points:[s.p1,s.p5,s.p6,s.p2],color:this.faceRightColor,normal:[1,0,0]},front:{points:[s.p0,s.p1,s.p5,s.p4],color:this.faceFrontColor,normal:[0,-1,0]},back:{points:[s.p3,s.p2,s.p6,s.p7],color:this.faceBackColor,normal:[0,1,0]}};this.visibleFaces.map((t=>{const e=o[t];if(!e)return null;const i=e.points.reduce(((t,e)=>({x:t.x+e.x,y:t.y+e.y})),{x:0,y:0});return i.x/=e.points.length,i.y/=e.points.length,{key:t,face:e,depth:i.x*i.x+i.y*i.y}})).filter((t=>null!==t)).sort(((t,e)=>e.depth-t.depth)).forEach((({key:t,face:e})=>{(null==e?void 0:e.color)&&ht.shapes.polygon(e.points,e.color,this.strokeColor,this.lineWidth)}))}getBounds(){const t=1.5*this.size;return{x:this.x-t/2,y:this.y-t/2,width:t,height:t}}},t.Cursor=class extends St{constructor(t,e,i=null,s={}){super(t,s),this.normalShape=e,this.pressedShape=i||e,this.active=!1,this.offsetX=0,this.offsetY=0,this.isDown=!1,this.game.events.on("inputmove",(t=>{this.x=t.x,this.y=t.y})),this.game.events.on("inputdown",(()=>{this.isDown=!0})),this.game.events.on("inputup",(()=>{this.isDown=!1})),this.game.events.on("mouseover",(()=>{this.visible=!1})),this.game.events.on("mouseout",(()=>{this.visible=!0}))}activate(){this.active=!0,this.game.canvas.style.cursor="none"}deactivate(){this.active=!1,this.game.canvas.style.cursor="default"}draw(){if(super.draw(),!this.active)return;const t=this.isDown&&this.pressedShape?this.pressedShape:this.normalShape;t&&t.render()}},t.Cylinder=class extends ft{constructor(t=40,e={}){super(e),this.radius=t,this.height=e.height||80,this.segments=e.segments||24,this.topColor=e.topColor||"#FF00FF",this.bottomColor=e.bottomColor||"#FF0FFF",this.sideColor=e.sideColor||"#00FF00",this.stroke=e.stroke||"#000000",this.lineWidth=e.lineWidth||1,this.rotationX=e.rotationX||0,this.rotationY=e.rotationY||0,this.rotationZ=e.rotationZ||0,this.visibleFaces=e.visibleFaces||["top","bottom","side"]}setRotation(t,e,i){return this.rotationX=t,this.rotationY=e,this.rotationZ=i,this}rotate(t,e,i){return this.rotationX+=t,this.rotationY+=e,this.rotationZ+=i,this}draw(){super.draw();const t=this.radius,e=this.height/2,i=(t,e,i)=>{let s=e,o=i;e=s*Math.cos(this.rotationX)-o*Math.sin(this.rotationX);let n=t;return o=i=s*Math.sin(this.rotationX)+o*Math.cos(this.rotationX),t=n*Math.cos(this.rotationY)+o*Math.sin(this.rotationY),i=-n*Math.sin(this.rotationY)+o*Math.cos(this.rotationY),n=t,s=e,{x:t=n*Math.cos(this.rotationZ)-s*Math.sin(this.rotationZ),y:e=n*Math.sin(this.rotationZ)+s*Math.cos(this.rotationZ),z:i}},s=(t,e,s)=>{const o=i(t,e,s);return{x:(o.x-o.y)*Math.cos(Math.PI/6),y:(o.x+o.y)*Math.sin(Math.PI/6)-o.z,z:o.z}},o=[],n=[],a=2*Math.PI/this.segments;for(let i=0;i<this.segments;i++){const r=i*a,h=Math.cos(r)*t,l=Math.sin(r)*t;o.push(s(h,l,e)),n.push(s(h,l,-e))}const r=[];for(let t=0;t<this.segments;t++){const e=(t+1)%this.segments;r.push({points:[n[t],n[e],o[e],o[t]],z:(o[t].z+o[e].z+n[t].z+n[e].z)/4})}const h=[];this.visibleFaces.includes("top")&&h.push({type:"top",points:o,z:e}),this.visibleFaces.includes("bottom")&&h.push({type:"bottom",points:[...n].reverse(),z:-e}),this.visibleFaces.includes("side")&&h.push(...r.map((t=>({type:"side",points:t.points,z:t.z})))),h.sort(((t,e)=>e.z-t.z));for(const t of h){let e;switch(t.type){case"top":e=this.topColor;break;case"bottom":e=this.bottomColor;break;case"side":e=this.sideColor}ht.shapes.polygon(t.points,e,this.stroke,this.lineWidth)}}getBounds(){const t=1.5*Math.max(2*this.radius,this.height);return{x:this.x-t/2,y:this.y-t/2,width:t,height:t}}},t.DebugTab=Q,t.Diamond=class extends ft{constructor(t={}){super(t)}draw(){super.draw();const t=this.width/2,e=this.height/2,i=[{x:0,y:-e},{x:t,y:0},{x:0,y:e},{x:-t,y:0}];ht.shapes.polygon(i,this.color,this.stroke,this.lineWidth)}},t.Easing=Rt,t.Euclidian=ct,t.EventEmitter=wt,t.FPSCounter=class extends Et{constructor(t,e={}){super(t,"0 FPS",{x:0,y:0,font:"12px monospace",color:"#0f0",align:"center",baseline:"middle",debug:!1,...e}),this.fps=0,this._frames=0,this._accum=0}update(t){const e=this.game.actualFps;e&&(this._frames++,this._accum+=t,this._accum>=.5&&(this.fps=Math.round(e),this.text=`${this.fps} FPS`,this._accum=0,this._frames=0),super.update(t))}getBounds(){if(this.shape&&this.shape.getTextBounds){const t=this.shape.getTextBounds();return{x:t.x,y:t.y,width:t.width,height:t.height}}return super.getBounds()}getDebugBounds(){if(this.shape&&this.shape.getDebugBounds){const t=this.shape.getDebugBounds();return{x:t.x,y:t.y,width:t.width,height:t.height}}return super.getDebugBounds()}},t.Fractals=H,t.Game=class{constructor(t){S(this,_,0),S(this,v,0),this.canvas=t,this.ctx=t.getContext("2d"),this.events=new wt,this._cursor=null,this.lastTime=0,this.dt=0,this.running=!1,this._frame=0,this.pipeline=new ee(this),ht.init(this.ctx),this.targetFPS=60,this._frameInterval=1e3/this.targetFPS,this._accumulator=0,this._pauseOnBlur=!1,this._isPaused=!1,this._init=!1,this.initLogging()}setFPS(t){this.targetFPS=t,this._frameInterval=1e3/t}init(){this.initIO(),this.initMotion(),this._init=!0,this.logger.log("[Game] Initialized")}initMouse(){vt.init(this)}initTouch(){Pt.init(this)}initInput(){bt.init(this)}initKeyboard(){Ct.init(this)}initIO(){this.initMouse(),this.initTouch(),this.initInput(),this.initKeyboard()}initMotion(){te._active=[]}initLogging(){this.logger=new V("Game"),V.setOutput(console),V.disableAll(),V.disable(),V.setLevel(V.INFO),this.logger.groupCollapsed("Initializing Game...")}enableLogging(){V.enable()}disableLogging(){V.disableAll(),V.disable()}markBoundsDirty(){this._boundsDirty=!0}get boundsDirty(){return this._boundsDirty}set boundsDirty(t){this._boundsDirty=t}enableFluidSize(t=window){if(t===window){const t=()=>{var t;this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,I(this,_)===this.canvas.width&&I(this,v)===this.canvas.height||(this.markBoundsDirty(),null==(t=this.onResize)||t.call(this)),B(this,_,this.canvas.width),B(this,v,this.canvas.height)};t(),window.addEventListener("resize",t),this._fluidResizeCleanup=()=>{window.removeEventListener("resize",t)}}else{if(!("ResizeObserver"in window))return void console.warn("ResizeObserver not supported in this browser.");const e=()=>{const e=t.getBoundingClientRect();this.canvas.width=e.width,this.canvas.height=e.height},i=new ResizeObserver((()=>{e()}));i.observe(t),e(),this._fluidResizeCleanup=()=>i.disconnect()}}disableFluidSize(){this._fluidResizeCleanup&&(this._fluidResizeCleanup(),this._fluidResizeCleanup=null)}start(){if(this.logger.groupCollapsed("[Game] Starting..."),this.init(),!this._init)throw new Error("Game not initialized. Did you call init()? Remember to call super.init() in your subclass.");this.running=!0,this.loop=this.loop.bind(this),requestAnimationFrame(this.loop),this.logger.log("[Game] Started"),this.logger.groupEnd()}stop(){this.running=!1,this.logger.log("[Game] Stopped")}restart(){this.pipeline.clear(),this.init(),this.start(),this.logger.log("[Game] Restarted")}loop(t){if(!this.running)return;const e=t-this.lastTime;if(this.lastTime=t,this._accumulator+=e,this.actualFps=1e3/e,this._accumulator>=this._frameInterval){const t=this._frameInterval/1e3;this.dt=t,this._frame++,this.logger.groupCollapsed(`Frame #${this._frame}`),this.logger.time("render time"),this.update(t),this.render(),this.logger.timeEnd("render time"),this.logger.groupEnd(),this._accumulator-=this._frameInterval}this.boundsDirty&&(this.boundsDirty=!1),requestAnimationFrame(this.loop)}update(t){this.pipeline.update(t)}render(){this.running&&this.clear(),this.pipeline.render()}clear(){ht.clear()}get width(){return this.canvas.width}get height(){return this.canvas.height}set backgroundColor(t){this.canvas.style.backgroundColor=t}set cursor(t){this._cursor&&(this._cursor.destroy(),this.pipeline.remove(this._cursor)),this._cursor=t,this._cursor.activate(),this.pipeline.add(t)}get cursor(){return this._cursor}resetCursor(){this._cursor&&(this._cursor.destroy(),this.pipeline.remove(this._cursor),this._cursor=null)}enablePauseOnBlur(t){this._pauseOnBlur=t,t?window.addEventListener("visibilitychange",this._handleVisibilityChange.bind(this),!1):window.removeEventListener("visibilitychange",this._handleVisibilityChange.bind(this),!1)}_handleVisibilityChange(){this.logger.log("Visibility change detected"),document.hidden?this._pauseOnBlur&&this.running&&(this._isPaused=!0,this.stop(),this.logger.log("Paused due to tab visibility change")):this._isPaused&&(this._isPaused=!1,this.start(),this.logger.log("Resumed after tab visibility change"))}},t.GameObject=St,t.GameObjectShapeWrapper=Bt,t.Geometry2d=dt,t.GridLayout=class extends Ot{constructor(t,e={}){super(t,e),this.columns=e.columns??4,this.debug=e.debug??!1}calculateLayout(){return this.children.length?Y(this.children,{columns:this.columns,spacing:this.spacing,padding:this.padding,centerItems:this.centerItems,width:this.autoSize?void 0:this.width,height:this.autoSize?void 0:this.height}):null}getLayoutOffset(){return{offsetX:-this.width/2,offsetY:-this.height/2}}},t.Group=mt,t.Heart=class extends ft{constructor(t={}){super(t)}draw(){super.draw();const t=this.width,e=this.height,i=.3*e,s=ht.lines;s.beginPath(),s.moveTo(0,i),s.bezierCurveTo(0,0,-t/2,0,-t/2,i),s.bezierCurveTo(-t/2,.8*e,0,e,0,e),s.bezierCurveTo(0,e,t/2,.8*e,t/2,i),s.bezierCurveTo(t/2,0,0,0,0,i),s.closePath(),this.color&&ht.colors.fill(this.color),this.stroke&&ht.colors.stroke(this.stroke,this.lineWidth)}getBounds(){return{x:this.x,y:this.y+this.height/2,width:this.width,height:this.height}}},t.Hexagon=class extends ft{constructor(t,e={}){super(e),this.radius=t}draw(){super.draw();const t=Array.from({length:6},((t,e)=>{const i=Math.PI/3*e;return{x:Math.cos(i)*this.radius,y:Math.sin(i)*this.radius}}));ht.shapes.polygon(t,this.color,this.stroke,this.lineWidth)}},t.HorizontalLayout=class extends Ot{calculateLayout(){return R(this.children,{spacing:this.spacing,padding:this.padding,align:this.align,centerItems:!0})}getLayoutOffset(){return{offsetX:-this.width/2,offsetY:0}}},t.ImageGo=class extends Bt{constructor(t,e,i={}){super(t,e instanceof At?e:new At(e,i),i)}reset(){this.shape.reset()}},t.Input=bt,t.Keys=Ct,t.LayoutScene=Ot,t.Line=class extends ft{constructor(t=40,e={}){super(e),this.length=t}draw(){super.draw();const t=this.length/2;ht.lines.line(-t,-t,t,t,this.stroke,this.lineWidth)}},t.Loggable=J,t.Logger=V,t.Motion=Kt,t.Mouse=vt,t.Noise=N,t.OutlinedText=class extends ft{constructor(t,e,i,s={}){super(t,e,s),this.text=i,this.centered=s.centered||!1,this.color=s.color||"#000000",this.stroke=s.stroke||"#FFFFFF",this.lineWidth=s.lineWidth||1,this.font=s.font||null,this.align=s.align||"left",this.baseline=s.baseline||"alphabetic",this.calculateDimensions()}calculateDimensions(){if(!ht.ctx)return console.warn("Painter context not initialized. Cannot calculate text dimensions."),this.width=0,void(this.height=0);const t=ht.text.font();this.font&&ht.text.setFont(this.font);const e=ht.text.measureText(this.text);if(this.width=e.width,this.font){const t=parseInt(this.font);this.height=isNaN(t)?20:t}else this.height=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent||20;this.width+=2*this.lineWidth,this.height+=2*this.lineWidth,ht.text.setFont(t)}setText(t){this.text=t,this.calculateDimensions()}draw(){if(super.draw(),!ht.ctx)return void console.warn("Painter context not initialized. Cannot draw text.");let t=0;this.font&&ht.text.setFont(this.font),ht.text.setTextAlign(this.align),ht.text.setTextBaseline(this.baseline),this.centered&&("middle"===this.baseline||"alphabetic"===this.baseline?t=0:"top"===this.baseline?t=this.height/2:"bottom"===this.baseline&&(t=-this.height/2)),ht.outlinedText(this.text,0,t,this.color,this.stroke,this.lineWidth,this.font)}getBounds(){if(!ht.ctx)return super.getBounds();const t=ht.text.font();ht.text.setFont(this.font);const e=ht.text.measureText(this.text),i=e.width,s=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent||parseInt(this.font)||20;return ht.text.setFont(t),this.width=i,this.height=s,{x:this.x,y:this.y,width:i,height:s}}},t.Painter=ht,t.PainterColors=lt,t.PainterEffects=et,t.PainterImages=it,t.PainterLines=st,t.PainterOpacity=ot,t.PainterShapes=nt,t.PainterText=at,t.PatternRectangle=class extends ft{constructor(t=null,e="repeat",i={}){super(i),this.image=t,this.repetition=e,this.pattern=null,t&&this._tryCreatePattern(t)}_tryCreatePattern(t){t instanceof HTMLImageElement||"boolean"==typeof t.complete?t.complete?this._createPattern():t.addEventListener("load",(()=>this._createPattern()),{once:!0}):this._createPattern()}_createPattern(){this.pattern=ht.img.createPattern(this.image,this.repetition)}setImage(t,e){this.image=t,e&&(this.repetition=e),this.pattern=null,this._tryCreatePattern(t)}draw(){super.draw(),!this.pattern&&this.image&&this._tryCreatePattern(this.image);const t=-this.width/2,e=-this.height/2;this.pattern?ht.img.fillPattern(this.pattern,t,e,this.width,this.height):this.strokeColor&&ht.shapes.outlineRect(t,e,this.width,this.height,this.strokeColor,this.lineWidth)}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},t.Patterns=class{static void(t,e,i={}){const{background:s=[255,255,255,255],foreground:o=[0,0,200,255]}=i,n=new Uint8ClampedArray(t*e*4);for(let t=0;t<n.length;t+=4)n[t]=s[0],n[t+1]=s[1],n[t+2]=s[2],n[t+3]=s[3];return n}static solidGrid(t,e,i={}){const{spacing:s=8,background:o=[0,0,0,0],foreground:n=[128,128,128,255]}=i,a=new Uint8ClampedArray(t*e*4);for(let i=0;i<e;i++){const e=i%s==0;for(let r=0;r<t;r++){const h=4*(i*t+r),l=r%s==0||e?n:o;a[h]=l[0],a[h+1]=l[1],a[h+2]=l[2],a[h+3]=l[3]}}return a}static checkerboard(t,e,i={}){const{cellSize:s=8,color1:o=[0,0,0,255],color2:n=[255,255,255,255]}=i,a=new Uint8ClampedArray(t*e*4);for(let i=0;i<e;i++){const e=Math.floor(i/s);for(let r=0;r<t;r++){const h=(Math.floor(r/s)+e)%2==0?o:n,l=4*(i*t+r);a.set(h,l)}}return a}static stripes(t,e,i={}){const{spacing:s=4,thickness:o=1,background:n=[0,0,0,0],foreground:a=[255,255,0,255]}=i,r=new Uint8ClampedArray(t*e*4);for(let i=0;i<e;i++)for(let e=0;e<t;e++){const h=(e+i)%s<o,l=4*(i*t+e);r.set(h?a:n,l)}return r}static honeycomb(t,e,i={}){const{radius:s=10,lineWidth:o=1,foreground:n=[255,255,255,255],background:a=[0,0,0,255]}=i,r=new Uint8ClampedArray(t*e*4);for(let t=0;t<r.length;t+=4)r[t]=a[0],r[t+1]=a[1],r[t+2]=a[2],r[t+3]=a[3];const h=Math.floor(t/2),l=Math.floor(e/2),c=(t,e,i,s,o)=>{const n=Math.abs(t-i),a=Math.abs(e-s),r=o*Math.sqrt(3)/2;return!(a>r)&&!(n>o)&&o*r*2>=o*a*2+r*n},d=s-o,u=s*Math.sqrt(3),g=Math.max(0,Math.floor(h-s-1)),p=Math.min(t-1,Math.ceil(h+s+1)),f=Math.max(0,Math.floor(l-u/2-1)),m=Math.min(e-1,Math.ceil(l+u/2+1));for(let e=f;e<=m;e++)for(let i=g;i<=p;i++){const o=c(i,e,h,l,s),a=d>0&&c(i,e,h,l,d);if(o&&!a){const s=4*(e*t+i);r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2],r[s+3]=n[3]}}return r}static harlequin(t,e,i={}){const{size:s=20,spacing:o=0,background:n=[255,255,255,255],foreground:a=[0,0,0,255]}=i,r=new Uint8ClampedArray(t*e*4);for(let t=0;t<r.length;t+=4)r[t]=n[0],r[t+1]=n[1],r[t+2]=n[2],r[t+3]=n[3];const h=2*s,l=2*s,c=h+o,d=l+o;for(let i=-1;i<e/d+1;i++)for(let s=-1;s<t/c+1;s++){const o=s*c+c/2,n=i*d+d/2;if((i+s)%2!=0)continue;const m=Math.max(0,Math.floor(o-h/2)),x=Math.min(t-1,Math.ceil(o+h/2)),M=Math.max(0,Math.floor(n-l/2)),w=Math.min(e-1,Math.ceil(n+l/2));for(let e=M;e<=w;e++)for(let i=m;i<=x;i++)if(u=i,g=e,p=o,f=n,Math.abs(u-p)/(h/2)+Math.abs(g-f)/(l/2)<=1){const s=4*(e*t+i);r[s]=a[0],r[s+1]=a[1],r[s+2]=a[2],r[s+3]=a[3]}}var u,g,p,f;return r}static circles(t,e,i={}){const{radius:s=10,lineWidth:o=2,spacing:n=5,background:a=[0,0,0,255],foreground:r=[255,255,255,255]}=i,h=new Uint8ClampedArray(t*e*4);for(let t=0;t<h.length;t+=4)h[t]=a[0],h[t+1]=a[1],h[t+2]=a[2],h[t+3]=a[3];const l=2*s+n,c=(t,e,i,s,o)=>{const n=t-i,a=e-s;return n*n+a*a<=o*o};for(let i=0;i<Math.ceil(e/l)+1;i++)for(let n=0;n<Math.ceil(t/l)+1;n++){const a=n*l+s,d=i*l+s;if(a<-s||a>t+s||d<-s||d>e+s)continue;const u=Math.max(0,Math.floor(a-s)),g=Math.min(t-1,Math.ceil(a+s)),p=Math.max(0,Math.floor(d-s)),f=Math.min(e-1,Math.ceil(d+s)),m=s-o;for(let e=p;e<=f;e++)for(let i=u;i<=g;i++){const o=c(i,e,a,d,s),n=c(i,e,a,d,m);if(o&&!n){const s=4*(e*t+i);h[s]=r[0],h[s+1]=r[1],h[s+2]=r[2],h[s+3]=r[3]}}}return h}static diamonds(t,e,i={}){const{size:s=16,squareSize:o=6,background:n=[255,255,255,255],foreground:a=[0,0,0,255],innerColor:r=[255,255,255,255]}=i,h=new Uint8ClampedArray(t*e*4);for(let t=0;t<h.length;t+=4)h[t]=n[0],h[t+1]=n[1],h[t+2]=n[2],h[t+3]=n[3];const l=s,c=(t,e,i,s,o)=>Math.abs(t-i)<=o/2&&Math.abs(e-s)<=o/2;for(let i=-1;i<e/l+1;i++)for(let s=-1;s<t/l+1;s++){const n=s*l+l/2,m=i*l+l/2;if(n<-l||n>t+l||m<-l||m>e+l)continue;const x=Math.max(0,Math.floor(n-l/2)),M=Math.min(t-1,Math.ceil(n+l/2)),w=Math.max(0,Math.floor(m-l/2)),y=Math.min(e-1,Math.ceil(m+l/2));for(let e=w;e<=y;e++)for(let i=x;i<=M;i++){const s=(d=i,u=e,g=n,p=m,f=l,Math.abs(d-g)+Math.abs(u-p)<=f/2),x=c(i,e,n,m,o);if(s){const s=4*(e*t+i);x?(h[s]=r[0],h[s+1]=r[1],h[s+2]=r[2],h[s+3]=r[3]):(h[s]=a[0],h[s+1]=a[1],h[s+2]=a[2],h[s+3]=a[3])}}}var d,u,g,p,f;return h}static cubes(t,e,i={}){const{size:s=10,spacing:o=2,background:n=[0,0,0,255],foreground:a=[255,100,0,255]}=i,r=new Uint8ClampedArray(t*e*4);for(let t=0;t<r.length;t+=4)r[t]=n[0],r[t+1]=n[1],r[t+2]=n[2],r[t+3]=n[3];const h=s+o;for(let i=0;i<Math.ceil(e/h)+1;i++)for(let o=0;o<Math.ceil(t/h)+1;o++){const n=o*h,l=i*h;if(!(n>=t||l>=e))for(let i=l;i<Math.min(l+s,e);i++)for(let e=n;e<Math.min(n+s,t);e++){const s=4*(i*t+e);r[s]=a[0],r[s+1]=a[1],r[s+2]=a[2],r[s+3]=a[3]}}return r}static cross(t,e,i={}){const{size:s=8,thickness:o=2,spacing:n=16,background:a=[255,255,255,255],foreground:r=[80,80,80,255]}=i,h=new Uint8ClampedArray(t*e*4);for(let t=0;t<h.length;t+=4)h[t]=a[0],h[t+1]=a[1],h[t+2]=a[2],h[t+3]=a[3];for(let i=0;i<Math.ceil(e/n)+1;i++)for(let a=0;a<Math.ceil(t/n)+1;a++){const l=a*n,c=i*n;if(l<-s||l>t+s||c<-s||c>e+s)continue;const d=l-s/2,u=l+s/2,g=c-o/2,p=c+o/2;for(let i=Math.max(0,Math.floor(g));i<Math.min(e,Math.ceil(p));i++)for(let e=Math.max(0,Math.floor(d));e<Math.min(t,Math.ceil(u));e++){const s=4*(i*t+e);h[s]=r[0],h[s+1]=r[1],h[s+2]=r[2],h[s+3]=r[3]}const f=l-o/2,m=l+o/2,x=c-s/2,M=c+s/2;for(let i=Math.max(0,Math.floor(x));i<Math.min(e,Math.ceil(M));i++)for(let e=Math.max(0,Math.floor(f));e<Math.min(t,Math.ceil(m));e++){const s=4*(i*t+e);h[s]=r[0],h[s+1]=r[1],h[s+2]=r[2],h[s+3]=r[3]}}return h}static mesh(t,e,i={}){const{spacing:s=20,lineWidth:o=2,background:n=[255,255,255,0],foreground:a=[0,0,0,255]}=i,r=new Uint8ClampedArray(t*e*4);for(let t=0;t<r.length;t+=4)r[t]=n[0],r[t+1]=n[1],r[t+2]=n[2],r[t+3]=n[3];for(let i=0;i<e;i++)for(let n=0;n<t;n++){const h=(n+i)%s,l=(n-i+e)%s;if(h<o||h>s-o||l<o||l>s-o){const e=4*(i*t+n);r[e]=a[0],r[e+1]=a[1],r[e+2]=a[2],r[e+3]=a[3]}}return r}static isometric(t,e,i={}){const{cellSize:s=20,lineWidth:o=1,background:n=[0,0,0,0],foreground:a=[0,255,0,255]}=i,r=new Uint8ClampedArray(t*e*4);for(let t=0;t<r.length;t+=4)r[t]=n[0],r[t+1]=n[1],r[t+2]=n[2],r[t+3]=n[3];const h=s,l=s/2;for(let i=0;i<e;i++)for(let e=0;e<t;e++){const s=e%h,n=i%l,c=n-s/2,d=n+s/2-l,u=Math.abs(c)<o/2,g=Math.abs(d)<o/2;if(u||g){const s=4*(i*t+e);r[s]=a[0],r[s+1]=a[1],r[s+2]=a[2],r[s+3]=a[3]}}return r}static weave(t,e,i={}){const{tileSize:s=40,lineWidth:o=2,background:n=[255,255,255,255],foreground:a=[0,0,0,255]}=i,r=new Uint8ClampedArray(t*e*4);for(let t=0;t<r.length;t+=4)r[t]=n[0],r[t+1]=n[1],r[t+2]=n[2],r[t+3]=n[3];for(let i=0;i<e;i++)for(let e=0;e<t;e++){const n=e%s,h=i%s,l=Math.abs((h+s/2)%s-s/2)<o/2,c=Math.abs((n+2*h+1.5*s)%s-s/2)<o/2,d=Math.abs((n-2*h+1.5*s)%s-s/2)<o/2;if(l||c||d){const s=4*(i*t+e);r[s]=a[0],r[s+1]=a[1],r[s+2]=a[2],r[s+3]=a[3]}}return r}static perlinNoise(t,e,i={}){const{background:s=[0,0,0,0],foreground:o=[255,255,255,255],scale:n=.1,octaves:a=4,persistence:r=.5,lacunarity:h=2,seed:l=65536*Math.random()}=i,c=new Uint8ClampedArray(t*e*4);N.seed(l);for(let i=0;i<e;i++)for(let e=0;e<t;e++){let l=1,d=1,u=0,g=0;for(let t=0;t<a;t++){const t=e*n*d,s=i*n*d;u+=N.perlin2(t,s)*l,g+=l,l*=r,d*=h}u/=g;const p=.5*(u+1),f=[Math.floor(s[0]+p*(o[0]-s[0])),Math.floor(s[1]+p*(o[1]-s[1])),Math.floor(s[2]+p*(o[2]-s[2])),Math.floor(s[3]+p*(o[3]-s[3]))],m=4*(i*t+e);c.set(f,m)}return c}static circularGradient(t,e,i={}){const{innerColor:s=[255,255,255,255],outerColor:o=[0,0,0,255],centerX:n=t/2,centerY:a=e/2,radius:r=Math.min(t,e)/2,fadeExponent:h=1}=i,l=new Uint8ClampedArray(t*e*4);for(let i=0;i<e;i++)for(let e=0;e<t;e++){const c=4*(i*t+e),d=e-n,u=i-a,g=Math.sqrt(d*d+u*u);let p=Math.min(g/r,1);p=Math.pow(p,h);const f=[Math.floor(s[0]+p*(o[0]-s[0])),Math.floor(s[1]+p*(o[1]-s[1])),Math.floor(s[2]+p*(o[2]-s[2])),Math.floor(s[3]+p*(o[3]-s[3]))];l.set(f,c)}return l}static noiseDisplacement(t,e,i={}){const{gridSpacing:s=16,gridColor:o=[255,255,255,255],background:n=[0,0,0,0],displacementScale:a=8,noiseScale:r=.05,gridThickness:h=1,seed:l=65536*Math.random()}=i,c=new Uint8ClampedArray(t*e*4);N.seed(l);for(let t=0;t<c.length;t+=4)c.set(n,t);for(let i=0;i<e;i++)for(let e=0;e<t;e++){const n=e+N.perlin2(e*r,i*r)*a,l=i+N.perlin2((e+31.416)*r,(i+27.182)*r)*a;if(n%s<h||n%s>s-h||l%s<h||l%s>s-h){const s=4*(i*t+e);c.set(o,s)}}return c}static dotPattern(t,e,i={}){const{dotSize:s=3,spacing:o=12,dotColor:n=[0,0,0,255],background:a=[255,255,255,255],useNoise:r=!1,noiseScale:h=.1,noiseDensity:l=.4,seed:c=65536*Math.random()}=i,d=new Uint8ClampedArray(t*e*4);r&&N.seed(c);for(let t=0;t<d.length;t+=4)d.set(a,t);if(r){for(let i=0;i<e;i++)for(let o=0;o<t;o++)if(.5*(N.perlin2(o*h,i*h)+1)>l)for(let a=-s;a<=s;a++)for(let r=-s;r<=s;r++){const h=o+r,l=i+a;if(h>=0&&h<t&&l>=0&&l<e&&r*r+a*a<=s*s){const e=4*(l*t+h);d.set(n,e)}}}else for(let i=Math.floor(o/2);i<e;i+=o)for(let a=Math.floor(o/2);a<t;a+=o)for(let o=-s;o<=s;o++)for(let r=-s;r<=s;r++){const h=a+r,l=i+o;if(h>=0&&h<t&&l>=0&&l<e&&r*r+o*o<=s*s){const e=4*(l*t+h);d.set(n,e)}}return d}static voronoi(t,e,i={}){const{cellCount:s=20,cellColors:o=null,edgeColor:n=[0,0,0,255],edgeThickness:a=1.5,seed:r=1e3*Math.random(),jitter:h=.5,baseColor:l=null,colorVariation:c=.3}=i,d=new Uint8ClampedArray(t*e*4);N.seed(r);const u=[],g=[],p=()=>{let t=1e4*Math.sin(.167*r+.423*u.length);return t-Math.floor(t)},f=Math.sqrt(s),m=t/f,x=e/f,M=t=>{if(l){const[e,i,s,o]=l,n=Math.max(e,i,s)/255,a=Math.min(e,i,s)/255,r=(n+a)/2;let h,d;if(n===a)h=d=0;else{const t=n-a;d=r>.5?t/(2-n-a):t/(n+a),h=n===e/255?(i/255-s/255)/t+(i/255<s/255?6:0):n===i/255?(s/255-e/255)/t+2:(e/255-i/255)/t+4,h/=6}const u=N.perlin2(.15*t,0)*c*.3,g=N.perlin2(0,.15*t)*c,f=N.perlin2(.15*t,.15*t)*c*.5;h=(h+u)%1,d=Math.min(1,Math.max(0,d*(1+g)));const m=Math.min(.9,Math.max(.1,r*(1+f)));let x,M,w;if(0===d)x=M=w=m;else{const t=(t,e,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t),e=m<.5?m*(1+d):m+d-m*d,i=2*m-e;x=t(i,e,h+1/3),M=t(i,e,h),w=t(i,e,h-1/3)}const y=.05,b=()=>(2*p()-1)*y;return[Math.min(255,Math.max(0,Math.floor(255*x*(1+b())))),Math.min(255,Math.max(0,Math.floor(255*M*(1+b())))),Math.min(255,Math.max(0,Math.floor(255*w*(1+b())))),o]}{let e,i,s;const o=.618033988749895*t%1*6,n=Math.floor(o),a=o-n,r=.5,h=.5*(1-a),l=.5*(1-(1-a));switch(n%6){case 0:e=.5,i=l,s=r;break;case 1:e=h,i=.5,s=r;break;case 2:e=r,i=.5,s=l;break;case 3:e=r,i=h,s=.5;break;case 4:e=l,i=r,s=.5;break;case 5:e=.5,i=r,s=h}return[Math.floor(255*e+50+100*p()),Math.floor(255*i+50+100*p()),Math.floor(255*s+50+100*p()),255]}};for(let t=0;t<f;t++)for(let e=0;e<f&&!(u.length>=s);e++){const i=e*m+m/2,s=t*x+x/2,n=(2*p()-1)*h*m,a=(2*p()-1)*h*x;u.push({x:Math.floor(i+n),y:Math.floor(s+a)}),o&&u.length-1<o.length?g.push(o[u.length-1]):g.push(M(u.length-1))}const w=(i,s,o,n)=>{let a=Math.abs(i-o),r=Math.abs(s-n);return a=Math.min(a,t-a),r=Math.min(r,e-r),.8*Math.sqrt(a*a+r*r)+.2*(a+r)};for(let i=0;i<e;i++)for(let s=0;s<t;s++){const o=4*(i*t+s);let r=1/0,h=1/0,l=0;for(let t=0;t<u.length;t++){const e=w(s,i,u[t].x,u[t].y);e<r?(h=r,r=e,l=t):e<h&&(h=e)}for(let o=0;o<u.length;o++)for(let n=-1;n<=1;n++)for(let a=-1;a<=1;a++){if(0===n&&0===a)continue;const c=u[o].x+n*t,d=u[o].y+a*e,g=Math.sqrt(Math.pow(s-c,2)+Math.pow(i-d,2));g<r?(h=r,r=g,l=o):g<h&&(h=g)}h-r<a?d.set(n,o):d.set(g[l],o)}return d}static penrose(t,e,i={}){return function(t=800,e=800,i){const{divisions:s=5,zoomType:o="in",color1:n=[255,0,0,255],color2:a=[0,0,255,255],color3:r=[0,0,0,255],backgroundColor:h=[255,255,255,255]}=i||{},l=new Uint8ClampedArray(t*e*4);for(let t=0;t<l.length;t+=4)l[t]=h[0],l[t+1]=h[1],l[t+2]=h[2],l[t+3]=h[3]||255;const c="in"===o?1:2,d=Math.max(t,e),u=d/c,g=d/c,p=.5*c,f=.5*c,m=(Math.sqrt(5)+1)/2;let x=[];for(let t=0;t<10;t++){const e=X.fromPolar(1,(2*t-1)*Math.PI/10),i=X.fromPolar(1,(2*t+1)*Math.PI/10);t%2==0?x.push(["thin",new X(0),i,e]):x.push(["thin",new X(0),e,i])}for(let t=0;t<s;t++){const t=[];for(const[e,i,s,o]of x)if("thin"===e){const e=i.add(s.subtract(i).scale(1/m));t.push(["thin",o,e,s]),t.push(["thicc",e,o,i])}else{const e=s.add(i.subtract(s).scale(1/m)),n=s.add(o.subtract(s).scale(1/m));t.push(["thicc",n,o,i]),t.push(["thicc",e,n,s]),t.push(["thin",n,e,i])}x=t}function M(i){return{x:Math.floor((i.real*u+p*u)*t/d),y:Math.floor((i.imag*g+f*g)*e/d)}}for(const[i,s,o,r]of x)U(l,M(s),M(o),M(r),"thin"===i?n:a,t,e);if(r&&r[3]>0)for(const[i,s,o,n]of x){const i=M(s),a=M(o),h=M(n);q(l,i,a,r,t,e),q(l,a,h,r,t,e),q(l,h,i,r,t,e)}return l}(t,e,i)}},t.PieSlice=class extends ft{constructor(t,e,i,s={}){super(s),this.radius=t,this.startAngle=e,this.endAngle=i}draw(){super.draw(),ht.lines.beginPath(),ht.lines.moveTo(0,0),ht.shapes.arc(0,0,this.radius,this.startAngle,this.endAngle),ht.lines.closePath(),this.color&&ht.colors.fill(this.color),this.stroke&&ht.colors.stroke(this.stroke,this.lineWidth)}},t.Pin=class extends ft{constructor(t=20,e={}){super(e),this.radius=t}draw(){super.draw();const t=this.radius,e=2.5*t;ht.lines.beginPath(),ht.shapes.arc(0,0,t,Math.PI,0),ht.lines.lineTo(t,0),ht.lines.lineTo(0,e),ht.lines.lineTo(-t,0),ht.lines.closePath(),this.color&&ht.colors.fill(this.color),this.stroke&&ht.colors.stroke(this.stroke,this.lineWidth)}getBounds(){return{x:this.x,y:this.y+.98*this.radius,width:2*this.radius,height:2.5*this.radius}}},t.Pipeline=ee,t.Polygon=class extends ft{constructor(t=6,e=40,i={}){super(i),this.sides=t,this.radius=e}draw(){super.draw();const t=[],e=2*Math.PI/this.sides;for(let i=0;i<this.sides;i++){const s=i*e;t.push({x:Math.cos(s)*this.radius,y:Math.sin(s)*this.radius})}ht.shapes.polygon(t,this.color,this.stroke,this.lineWidth)}},t.Position=A,t.Prism=class extends ft{constructor(t=100,e={}){super(e),this.depth=t,this.faceTopColor=e.faceTopColor||"#eee",this.faceBottomColor=e.faceBottomColor||"#ccc",this.faceLeftColor=e.faceLeftColor||"#aaa",this.faceRightColor=e.faceRightColor||"#888",this.faceFrontColor=e.faceFrontColor||"#666",this.faceBackColor=e.faceBackColor||"#444",this.stroke=e.stroke||null,this.lineWidth=e.lineWidth||1,this.rotationX=e.rotationX||0,this.rotationY=e.rotationY||0,this.rotationZ=e.rotationZ||0,this.visibleFaces=e.visibleFaces||["top","left","right","front","back","bottom"]}setRotation(t,e,i){return this.rotationX=t,this.rotationY=e,this.rotationZ=i,this}rotate(t,e,i){return this.rotationX+=t,this.rotationY+=e,this.rotationZ+=i,this}draw(){super.draw();const t=this.width/2,e=this.height/2,i=this.depth/2,s=(t,e,i)=>{let s=e,o=i;e=s*Math.cos(this.rotationX)-o*Math.sin(this.rotationX);let n=t;return o=i=s*Math.sin(this.rotationX)+o*Math.cos(this.rotationX),t=n*Math.cos(this.rotationY)+o*Math.sin(this.rotationY),i=-n*Math.sin(this.rotationY)+o*Math.cos(this.rotationY),n=t,s=e,{x:t=n*Math.cos(this.rotationZ)-s*Math.sin(this.rotationZ),y:e=n*Math.sin(this.rotationZ)+s*Math.cos(this.rotationZ),z:i}},o=(t,e,i)=>{const o=s(t,e,i);return{x:(o.x-o.y)*Math.cos(Math.PI/6),y:(o.x+o.y)*Math.sin(Math.PI/6)-o.z,z:o.z}},n={p0:o(-t,-i,-e),p1:o(t,-i,-e),p2:o(0,-i,e),p3:o(-t,i,-e),p4:o(t,i,-e),p5:o(0,i,e)},a={front:{points:[n.p0,n.p1,n.p2],color:this.faceFrontColor},back:{points:[n.p3,n.p4,n.p5],color:this.faceBackColor},bottom:{points:[n.p0,n.p1,n.p4,n.p3],color:this.faceBottomColor},right:{points:[n.p1,n.p2,n.p5,n.p4],color:this.faceRightColor},left:{points:[n.p0,n.p2,n.p5,n.p3],color:this.faceLeftColor}};this.visibleFaces.filter((t=>a[t])).map((t=>{const e=a[t],i=e.points.reduce(((t,e)=>t+e.x),0)/e.points.length,s=e.points.reduce(((t,e)=>t+e.y),0)/e.points.length,o=e.points.reduce(((t,e)=>t+(e.z||0)),0)/e.points.length;return{key:t,face:e,depth:i*i+s*s+o*o}})).sort(((t,e)=>e.depth-t.depth)).forEach((({key:t,face:e})=>{(null==e?void 0:e.color)&&ht.shapes.polygon(e.points,e.color,this.stroke,this.lineWidth)}))}getBounds(){const t=1.5*Math.max(this.width,this.height,this.depth);return{x:this.x-t/2,y:this.y-t/2,width:t,height:t}}},t.Random=F,t.Rectangle=xt,t.Renderable=gt,t.Ring=class extends ft{constructor(t,e,i={}){super(i),this.outerRadius=t,this.innerRadius=e}draw(){super.draw(),ht.lines.beginPath(),ht.shapes.arc(0,0,this.outerRadius,0,2*Math.PI),ht.shapes.arc(0,0,this.innerRadius,0,2*Math.PI,!0),ht.lines.closePath(),this.color&&ht.colors.fill(this.color),this.stroke&&ht.colors.stroke(this.stroke,this.lineWidth)}},t.RoundedRectangle=class extends ft{constructor(t=0,e={}){super(e),"number"==typeof t?this.radii=[t,t,t,t]:Array.isArray(t)?this.radii=4===t.length?t:[t[0]||0,t[1]||t[0]||0,t[2]||t[0]||0,t[3]||t[1]||t[0]||0]:this.radii=[0,0,0,0]}draw(){super.draw();const t=-this.width/2,e=-this.height/2;this.color&&this.stroke?ht.shapes.roundRect(t,e,this.width,this.height,this.radii,this.color,this.stroke,this.lineWidth):this.color?ht.shapes.fillRoundRect(t,e,this.width,this.height,this.radii,this.color):this.stroke&&ht.shapes.strokeRoundRect(t,e,this.width,this.height,this.radii,this.stroke,this.lineWidth)}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},t.SVGShape=class extends ft{constructor(t,e={}){console.log("SVGShape",e.x),super(e),this.scale=e.scale||1,this.centerPath=void 0===e.centerPath||e.centerPath,this.animationProgress=void 0!==e.animationProgress?e.animationProgress:1,this.svgPathData=t,this.pathCommands=this.parseSVGPath(t),this.centerPath?this.pathCommands=this.centerAndScalePath(this.pathCommands,this.scale):this.pathCommands=this.scalePath(this.pathCommands,this.scale),this.prevX=0,this.prevY=0,this.currentPoint={x:0,y:0}}parseSVGPath(t){const e=/M\s*([-\d.]+)[,\s]*([-\d.]+)/g,i=/L\s*([-\d.]+)[,\s]*([-\d.]+)/g,s=/C\s*([-\d.]+)[,\s]*([-\d.]+)\s*([-\d.]+)[,\s]*([-\d.]+)\s*([-\d.]+)[,\s]*([-\d.]+)/g,o=[];let n;for(;null!==(n=e.exec(t));)o.push(["M",parseFloat(n[1]),parseFloat(n[2])]);for(;null!==(n=i.exec(t));){const t=parseFloat(n[1]),e=parseFloat(n[2]);let i=0,s=0;for(let t=o.length-1;t>=0;t--){const e=o[t];if("M"===e[0]){i=e[1],s=e[2];break}if("C"===e[0]){i=e[5],s=e[6];break}}const a=i+(t-i)/3,r=s+(e-s)/3,h=i+2*(t-i)/3,l=s+2*(e-s)/3;o.push(["C",a,r,h,l,t,e])}for(;null!==(n=s.exec(t));)o.push(["C",parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]),parseFloat(n[4]),parseFloat(n[5]),parseFloat(n[6])]);return/Z/g.test(t)&&o.push(["Z"]),o}centerAndScalePath(t,e){let i=1/0,s=1/0,o=-1/0,n=-1/0;for(const e of t)"M"===e[0]?(i=Math.min(i,e[1]),s=Math.min(s,e[2]),o=Math.max(o,e[1]),n=Math.max(n,e[2])):"C"===e[0]&&(i=Math.min(i,e[1],e[3],e[5]),s=Math.min(s,e[2],e[4],e[6]),o=Math.max(o,e[1],e[3],e[5]),n=Math.max(n,e[2],e[4],e[6]));const a=(i+o)/2,r=(s+n)/2;return this.originalWidth=(o-i)*e,this.originalHeight=(n-s)*e,t.map((t=>"M"===t[0]?["M",(t[1]-a)*e,(t[2]-r)*e]:"C"===t[0]?["C",(t[1]-a)*e,(t[2]-r)*e,(t[3]-a)*e,(t[4]-r)*e,(t[5]-a)*e,(t[6]-r)*e]:[...t]))}scalePath(t,e){let i=1/0,s=1/0,o=-1/0,n=-1/0;for(const e of t)"M"===e[0]?(i=Math.min(i,e[1]),s=Math.min(s,e[2]),o=Math.max(o,e[1]),n=Math.max(n,e[2])):"C"===e[0]&&(i=Math.min(i,e[1],e[3],e[5]),s=Math.min(s,e[2],e[4],e[6]),o=Math.max(o,e[1],e[3],e[5]),n=Math.max(n,e[2],e[4],e[6]));return this.originalWidth=(o-i)*e,this.originalHeight=(n-s)*e,t.map((t=>"M"===t[0]?["M",t[1]*e,t[2]*e]:"C"===t[0]?["C",t[1]*e,t[2]*e,t[3]*e,t[4]*e,t[5]*e,t[6]*e]:[...t]))}getBezierPoint(t,e){if("M"===t[0])return{x:t[1],y:t[2]};if("C"===t[0]){const i=this.prevX,s=this.prevY,o=t[1],n=t[2],a=t[3],r=t[4],h=t[5],l=t[6];return{x:Math.pow(1-e,3)*i+3*Math.pow(1-e,2)*e*o+3*(1-e)*Math.pow(e,2)*a+Math.pow(e,3)*h,y:Math.pow(1-e,3)*s+3*Math.pow(1-e,2)*e*n+3*(1-e)*Math.pow(e,2)*r+Math.pow(e,3)*l}}return{x:0,y:0}}getPartialPath(){const t=[];let e=this.pathCommands.length,i=Math.floor(this.animationProgress*e),s=this.animationProgress*e%1,o=!1;this.prevX=0,this.prevY=0;for(let e=0;e<i;e++){const i=this.pathCommands[e];t.push([...i]),"M"===i[0]?(this.prevX=i[1],this.prevY=i[2],o=!0):"C"===i[0]&&(this.prevX=i[5],this.prevY=i[6],o=!0)}if(i<e){const e=this.pathCommands[i];if("M"===e[0])t.push([...e]),this.prevX=e[1],this.prevY=e[2],this.currentPoint={x:e[1],y:e[2]},o=!0;else if("C"===e[0]){if(!o){for(let t=i-1;t>=0;t--)if("M"===this.pathCommands[t][0]){this.prevX=this.pathCommands[t][1],this.prevY=this.pathCommands[t][2],o=!0;break}o||(this.prevX=0,this.prevY=0)}const n=this.getBezierPoint(e,s);t.push(["C",e[1],e[2],e[3],e[4],n.x,n.y]),this.currentPoint=n}}return t}draw(){super.draw();const t=this.getPartialPath();ht.lines.path(t,this.color,this.stroke,this.lineWidth)}getCurrentPoint(){return{x:this.currentPoint.x,y:this.currentPoint.y}}setAnimationProgress(t){this.animationProgress=Math.max(0,Math.min(1,t))}calculateBounds(){return{x:this.x,y:this.y,width:this.originalWidth||100,height:this.originalHeight||100}}},t.Scene=Dt,t.Shape=ft,t.ShapeGOFactory=class{static create(t,e,i={}){const s={x:(null==e?void 0:e.x)??0,y:(null==e?void 0:e.y)??0,width:(null==e?void 0:e.width)??0,height:(null==e?void 0:e.height)??0,rotation:(null==e?void 0:e.rotation)??0,scaleX:(null==e?void 0:e.scaleX)??1,scaleY:(null==e?void 0:e.scaleY)??1,opacity:(null==e?void 0:e.opacity)??1,visible:(null==e?void 0:e.visible)??!0,active:!0,debug:(null==e?void 0:e.debug)??!1,color:(null==e?void 0:e.color)??null,stroke:(null==e?void 0:e.stroke)??null,lineWidth:(null==e?void 0:e.lineWidth)??1,lineJoin:(null==e?void 0:e.lineJoin)??"miter",lineCap:(null==e?void 0:e.lineCap)??"butt",miterLimit:(null==e?void 0:e.miterLimit)??10,...i,name:i.name??(null==e?void 0:e.constructor.name)??"ShapeWrapper"};return new Bt(t,e,s)}},t.Sphere=class extends ft{constructor(t=50,e={}){super(e),this.radius=t,this.hSegments=e.hSegments||16,this.vSegments=e.vSegments||12,this.color=e.color||"#6495ED",this.highlightColor=e.highlightColor||"#FFFFFF",this.wireframe=e.wireframe||!1,this.stroke=e.stroke||"#333333",this.lineWidth=e.lineWidth||1,this.rotationX=e.rotationX||0,this.rotationY=e.rotationY||0,this.rotationZ=e.rotationZ||0}setRotation(t,e,i){return this.rotationX=t,this.rotationY=e,this.rotationZ=i,this}rotate(t,e,i){return this.rotationX+=t,this.rotationY+=e,this.rotationZ+=i,this}calculateSurfaceColor(t,e,i){let s=t*(1/Math.sqrt(3))+e*(1/Math.sqrt(3))+i*(1/Math.sqrt(3));if(s=Math.max(.3,s),this.highlightColor){const t=this.hexToRgb(this.color),e=this.hexToRgb(this.highlightColor);return`rgb(${Math.round(t.r*(1-s)+e.r*s)}, ${Math.round(t.g*(1-s)+e.g*s)}, ${Math.round(t.b*(1-s)+e.b*s)})`}const o=this.hexToRgb(this.color);return`rgb(${Math.min(255,Math.round(o.r*s))}, ${Math.min(255,Math.round(o.g*s))}, ${Math.min(255,Math.round(o.b*s))})`}hexToRgb(t){const e={r:100,g:100,b:255};if(!t||"string"!=typeof t)return e;const i=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((t,e,i,s)=>e+e+i+i+s+s)),s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16)}:e}draw(){super.draw();const t=this.radius,e=(t,e,i)=>{let s=e,o=i;e=s*Math.cos(this.rotationX)-o*Math.sin(this.rotationX);let n=t;return o=i=s*Math.sin(this.rotationX)+o*Math.cos(this.rotationX),t=n*Math.cos(this.rotationY)+o*Math.sin(this.rotationY),i=-n*Math.sin(this.rotationY)+o*Math.cos(this.rotationY),n=t,s=e,{x:t=n*Math.cos(this.rotationZ)-s*Math.sin(this.rotationZ),y:e=n*Math.sin(this.rotationZ)+s*Math.cos(this.rotationZ),z:i}},i=(i,s,o)=>{const n=e(i,s,o);return{x:(n.x-n.y)*Math.cos(Math.PI/6),y:(n.x+n.y)*Math.sin(Math.PI/6)-n.z,z:n.z,nx:n.x/t,ny:n.y/t,nz:n.z/t}},s=[];for(let e=0;e<=this.vSegments;e++){const o=[],n=e/this.vSegments,a=Math.PI*n-Math.PI/2;for(let e=0;e<=this.hSegments;e++){const s=e/this.hSegments,n=2*Math.PI*s,r=t*Math.cos(a)*Math.cos(n),h=t*Math.cos(a)*Math.sin(n),l=t*Math.sin(a);o.push(i(r,h,l))}s.push(o)}const o=[];for(let t=0;t<this.vSegments;t++)for(let e=0;e<this.hSegments;e++){const i=s[t][e],n=s[t][e+1],a=s[t+1][e],r=s[t+1][e+1],h=(i.z+n.z+a.z+r.z)/4,l=(i.nx+n.nx+a.nx+r.nx)/4,c=(i.ny+n.ny+a.ny+r.ny)/4,d=(i.nz+n.nz+a.nz+r.nz)/4;o.push({points:[i,n,r,a],z:h,color:this.calculateSurfaceColor(l,c,d)})}if(o.sort(((t,e)=>e.z-t.z)),this.wireframe)for(const t of o){const e=t.points;for(let t=0;t<e.length;t++){const i=(t+1)%e.length;ht.lines.line(e[t].x,e[t].y,e[i].x,e[i].y,this.stroke,this.lineWidth)}}for(const t of o)ht.shapes.polygon(t.points,t.color,this.stroke,this.lineWidth)}getBounds(){const t=2*this.radius*1.5;return{x:this.x-t/2,y:this.y-t/2,width:t,height:t}}},t.Square=class extends xt{constructor(t,e={}){super(e),this.width=t,this.height=t}},t.Star=class extends ft{constructor(t=40,e=5,i=.5,s={}){super(s),this.radius=t,this.spikes=e,this.inset=i}draw(){super.draw();const t=Math.PI/this.spikes,e=-Math.PI/2;ht.lines.beginPath();for(let i=0;i<2*this.spikes;i++){const s=i%2==0?this.radius:this.radius*this.inset,o=i*t+e,n=Math.cos(o)*s,a=Math.sin(o)*s;0===i?ht.lines.moveTo(n,a):ht.lines.lineTo(n,a)}ht.lines.closePath(),this.color&&ht.colors.fill(this.color),this.stroke&&ht.colors.stroke(this.stroke,this.lineWidth)}},t.StickFigure=class extends ft{constructor(t=1,e={}){super(e),this.scale=t,this.stroke=e.stroke||"#000",this.headColor=e.headColor||this.stroke,this.jointColor=e.jointColor||this.stroke,this.lineWidth=e.lineWidth||2,this.showJoints=!1!==e.showJoints}draw(){super.draw();const t=this.scale,e=10*t,i=-30*t,s=i+e,o=s+40*t,n=s+10*t,a=15*t,r=10*t,h=o+40*t,l=3*t;ht.shapes.fillCircle(0,i,e,this.headColor),ht.shapes.strokeCircle(0,i,e,this.stroke,this.lineWidth),ht.lines.line(0,s,0,o,this.stroke,this.lineWidth),ht.lines.line(-a,n,a,n,this.stroke,this.lineWidth),ht.lines.line(0,o,-r,h,this.stroke,this.lineWidth),ht.lines.line(0,o,r,h,this.stroke,this.lineWidth),this.showJoints&&[[0,s],[-a,n],[a,n],[0,o],[-r,h],[r,h]].forEach((([t,e])=>ht.shapes.fillCircle(t,e,l,this.jointColor)))}getBounds(){const t=100*this.scale,e=40*this.scale;return{x:this.x,y:this.y,width:e,height:t}}},t.TaskManager=class{constructor(t){this.worker=new Worker(t),this.nextTaskId=1,this.pendingTasks=new Map,this.worker.onmessage=this.handleMessage.bind(this)}handleMessage(t){const{taskId:e,status:i,result:s,error:o}=t.data;if(this.pendingTasks.has(e)){const{resolve:t,reject:n}=this.pendingTasks.get(e);"complete"===i?t(s):"error"===i&&n(new Error(o)),this.pendingTasks.delete(e)}}runTask(t,e){return new Promise(((i,s)=>{const o=this.nextTaskId++;this.pendingTasks.set(o,{resolve:i,reject:s}),this.worker.postMessage({taskId:o,taskName:t,params:e})}))}terminate(){this.worker.terminate()}},t.Text=Et,t.TextShape=Mt,t.TileLayout=class extends Ot{constructor(t,e={}){super(t,e),this.columns=e.columns??4}calculateLayout(){return this.children.length?L(this.children,{columns:this.columns,spacing:this.spacing,padding:this.padding,centerItems:!0}):null}getLayoutOffset(){return{offsetX:-this.width/2,offsetY:-this.height/2}}},t.ToggleButton=class extends ie{constructor(t,e={}){const i=e.onClick;super(t,{...e,onClick:()=>{this.toggled=!this.toggled,"function"==typeof e.onToggle&&e.onToggle(this.toggled),"function"==typeof i&&i(),this.refreshToggleVisual()}}),this.colorActiveBg=e.colorActiveBg||"#444",this.colorActiveStroke=e.colorActiveStroke||"#0f0",this.colorActiveText=e.colorActiveText||"#0f0",this.toggled=!!e.startToggled,this.refreshToggleVisual()}toggle(t){this.toggled=t,this.refreshToggleVisual()}refreshToggleVisual(){this.toggled?(this.bg.fillColor=this.colorActiveBg,this.bg.strokeColor=this.colorActiveStroke,this.label.color=this.colorActiveText):(this.bg.fillColor=this.colors.default.bg,this.bg.strokeColor=this.colors.default.stroke,this.label.color=this.colors.default.text)}setState(t){super.setState(t),this.toggled&&(this.bg.fillColor=this.colorActiveBg,this.bg.strokeColor=this.colorActiveStroke,this.label.color=this.colorActiveText)}},t.Touch=Pt,t.Traceable=ut,t.Transformable=pt,t.Triangle=class extends ft{constructor(t=50,e={}){super(e),this.size=t}draw(){super.draw();const t=this.size/2,e=[{x:0,y:-t},{x:t,y:t},{x:-t,y:t}];ht.shapes.polygon(e,this.color,this.stroke,this.lineWidth)}},t.Tween=Wt,t.Tweenetik=te,t.VerticalLayout=class extends Ot{calculateLayout(){return z(this.children,{spacing:this.spacing,padding:this.padding,align:this.align,centerItems:!0})}getLayoutOffset(){return{offsetX:0,offsetY:-this.height/2}}},t.WrappedText=class extends ft{constructor(t,e,i,s,o=20,n={}){super(t,e,n),this.text=i,this.maxWidth=s,this.lineHeight=o,this.centered=n.centered||!1,this.color=n.color||"#000000",this.font=n.font||null,this.align=n.align||"left",this.baseline=n.baseline||"top",this.outlineColor=n.outlineColor||null,this.outlineWidth=n.outlineWidth||1,this.calculateDimensions()}calculateDimensions(){if(!ht.ctx)return console.warn("Painter context not initialized. Cannot calculate text dimensions."),this.width=this.maxWidth,this.height=this.lineHeight,void(this.lines=[this.text]);const t=ht.text.font(),e=ht.text.textAlign(),i=ht.text.textBaseline();this.font&&ht.text.setFont(this.font),ht.text.setTextAlign("left"),ht.text.setTextBaseline("top");const s=this.text.split(" ");let o="",n="";this.lines=[],this.width=0;for(let t=0;t<s.length;t++)n=o+s[t]+" ",ht.text.measureText(n).width>this.maxWidth&&t>0?(this.lines.push(o),this.width=Math.max(this.width,ht.text.measureText(o).width),o=s[t]+" "):o=n;this.lines.push(o),this.width=Math.max(this.width,ht.text.measureText(o).width),this.height=this.lines.length*this.lineHeight,ht.text.setFont(t),ht.text.setTextAlign(e),ht.text.setTextBaseline(i)}setText(t){this.text=t,this.calculateDimensions()}draw(){if(super.draw(),!ht.ctx)return void console.warn("Painter context not initialized. Cannot draw text.");let t=0,e=0;this.centered&&(t=-this.width/2,e=-this.height/2),this.font&&ht.text.setFont(this.font),ht.text.setTextAlign(this.align),ht.text.setTextBaseline(this.baseline);let i=t;"center"===this.align?i=0:"right"===this.align&&(i=t+this.width);for(let t=0;t<this.lines.length;t++){const s=e+t*this.lineHeight;this.outlineColor?ht.outlinedText(this.lines[t],i,s,this.color,this.outlineColor,this.outlineWidth,this.font):ht.text.fillText(this.lines[t],i,s,this.color,this.font)}}getBounds(){return this.centered?{x:this.x,y:this.y,width:this.width,height:this.height}:{x:this.x+this.width/2,y:this.y+this.height/2,width:this.width,height:this.height}}},t.ZOrderedCollection=O,t.applyAnchor=It,t.applyDraggable=function(t,e={}){const i=t.game;return t.dragging=!1,t.dragOffset={x:0,y:0},t._dragInputMoveHandler&&i.events.off("inputmove",t._dragInputMoveHandler),t._dragInputUpHandler&&i.events.off("inputup",t._dragInputUpHandler),"function"==typeof t.enableInteractivity?t.enableInteractivity(t):t.interactive=!0,t._dragInputDownHandler=i=>{t.dragging=!0,t.dragOffset.x=t.x-i.x,t.dragOffset.y=t.y-i.y,e.onDragStart&&e.onDragStart()},t._dragInputMoveHandler=e=>{t.dragging&&(t.x=e.x+t.dragOffset.x,t.y=e.y+t.dragOffset.y)},t._dragInputUpHandler=i=>{t.dragging&&(t.dragging=!1,e.onDragEnd&&e.onDragEnd())},t.on("inputdown",t._dragInputDownHandler),i.events.on("inputmove",t._dragInputMoveHandler),i.events.on("inputup",t._dragInputUpHandler),()=>{t.off("inputdown",t._dragInputDownHandler),i.events.off("inputmove",t._dragInputMoveHandler),i.events.off("inputup",t._dragInputUpHandler),delete t._dragInputDownHandler,delete t._dragInputMoveHandler,delete t._dragInputUpHandler,delete t.dragging,delete t.dragOffset}},t.applyLayout=W,t.bezierV1=Qt,t.bounceV1=zt,t.floatV1=Lt,t.followPath=Yt,t.gridLayout=Y,t.hopV1=Zt,t.horizontalLayout=R,t.orbitV1=Ft,t.oscillateV1=Xt,t.parabolicV1=Ht,t.patrolV1=Gt,t.pendulumV1=Nt,t.pulseV1=Ut,t.shakeV1=$t,t.spiralV1=qt,t.springV1=jt,t.swingV1=Vt,t.tileLayout=L,t.verticalLayout=z,t.waypointV1=Jt,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));